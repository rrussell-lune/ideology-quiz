<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Political Ideology Assessment</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Instrument+Serif:ital@0;1&family=JetBrains+Mono:wght@400;500&family=Outfit:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #0a0a0a;
            --bg-elevated: #141414;
            --bg-card: #1a1a1a;
            --text: #e8e8e8;
            --text-secondary: #888;
            --text-dim: #555;
            --accent: #c9f66f;
            --accent-dim: #a8d44e;
            --accent-glow: rgba(201, 246, 111, 0.15);
            --border: #2a2a2a;
            --border-light: #333;
            --danger: #ff6b6b;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Outfit', -apple-system, sans-serif;
            font-weight: 300;
            background: var(--bg);
            color: var(--text);
            line-height: 1.7;
            min-height: 100vh;
            -webkit-font-smoothing: antialiased;
        }

        ::selection {
            background: var(--accent);
            color: var(--bg);
        }

        .container {
            max-width: 680px;
            margin: 0 auto;
            padding: 2rem 1.5rem;
        }

        /* Header */
        header {
            text-align: center;
            padding: 3rem 0 2rem;
            margin-bottom: 2.5rem;
            position: relative;
        }

        header::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 60px;
            height: 1px;
            background: linear-gradient(90deg, transparent, var(--accent), transparent);
        }

        h1 {
            font-family: 'Instrument Serif', Georgia, serif;
            font-weight: 400;
            font-size: 2.25rem;
            letter-spacing: -0.02em;
            margin-bottom: 0.5rem;
            background: linear-gradient(135deg, var(--text) 0%, var(--text-secondary) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .subtitle {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.75rem;
            font-weight: 400;
            color: var(--text-dim);
            text-transform: uppercase;
            letter-spacing: 0.2em;
        }

        /* Screens */
        .screen {
            display: none;
            animation: fadeIn 0.4s cubic-bezier(0.16, 1, 0.3, 1);
        }

        .screen.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Welcome Screen */
        .intro-text {
            font-size: 1.1rem;
            margin-bottom: 2rem;
            color: var(--text-secondary);
        }

        .intro-text p {
            margin-bottom: 1.25rem;
        }

        .intro-text em {
            color: var(--text);
            font-style: italic;
        }

        .note-box {
            background: var(--bg-card);
            padding: 1.5rem;
            border-left: 2px solid var(--accent);
            margin: 2rem 0;
            font-size: 0.95rem;
            border-radius: 0 8px 8px 0;
        }

        .note-box strong {
            font-weight: 500;
            color: var(--accent);
            display: block;
            margin-bottom: 0.5rem;
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }

        /* Buttons */
        .btn {
            font-family: 'Outfit', sans-serif;
            font-size: 0.9rem;
            font-weight: 500;
            padding: 1rem 2.5rem;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.25s cubic-bezier(0.16, 1, 0.3, 1);
            display: inline-block;
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }

        .btn-primary {
            background: var(--accent);
            color: var(--bg);
            box-shadow: 0 0 30px var(--accent-glow);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 0 50px var(--accent-glow), 0 10px 30px rgba(0,0,0,0.3);
        }

        .btn-primary:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: transparent;
            color: var(--text-secondary);
            border: 1px solid var(--border);
        }

        .btn-secondary:hover {
            border-color: var(--text-secondary);
            color: var(--text);
        }

        .btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
            transform: none !important;
        }

        .btn-row {
            display: flex;
            gap: 1rem;
            margin-top: 2rem;
            flex-wrap: wrap;
        }

        /* Form Elements */
        label {
            display: block;
            font-weight: 400;
            font-size: 0.95rem;
            margin-bottom: 0.75rem;
            color: var(--text);
        }

        textarea, input[type="text"] {
            width: 100%;
            font-family: 'Outfit', sans-serif;
            font-size: 1rem;
            font-weight: 300;
            padding: 1rem 1.25rem;
            border: 1px solid var(--border);
            border-radius: 8px;
            background: var(--bg-elevated);
            color: var(--text);
            resize: vertical;
            transition: all 0.2s ease;
        }

        textarea::placeholder, input::placeholder {
            color: var(--text-dim);
        }

        textarea:focus, input[type="text"]:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px var(--accent-glow);
        }

        .form-group {
            margin-bottom: 2rem;
        }

        /* Preamble Questions */
        .preamble-section {
            margin-bottom: 3rem;
        }

        .preamble-section > p {
            color: var(--text-secondary);
            margin-bottom: 1.5rem;
        }

        .preamble-section h2 {
            font-family: 'Instrument Serif', Georgia, serif;
            font-size: 1.5rem;
            font-weight: 400;
            margin-bottom: 1rem;
            color: var(--text);
        }

        .axis-group {
            background: var(--bg-card);
            padding: 1.5rem;
            border-radius: 12px;
            margin-bottom: 1rem;
            border: 1px solid var(--border);
            transition: border-color 0.2s;
        }

        .axis-group:hover {
            border-color: var(--border-light);
        }

        .axis-group:focus-within {
            border-color: var(--accent);
        }

        .axis-group h3 {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
            font-weight: 500;
            margin-bottom: 0.75rem;
            color: var(--accent);
        }

        .axis-description {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-bottom: 1rem;
            line-height: 1.6;
        }

        .axis-description strong {
            color: var(--text);
            font-weight: 400;
        }

        /* Progress Bar */
        .progress-container {
            position: sticky;
            top: 0;
            background: linear-gradient(to bottom, var(--bg) 0%, var(--bg) 80%, transparent 100%);
            padding: 1.5rem 0 2rem;
            z-index: 100;
            margin-bottom: 0.5rem;
        }

        .progress-bar {
            height: 3px;
            background: var(--border);
            border-radius: 2px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: var(--accent);
            transition: width 0.4s cubic-bezier(0.16, 1, 0.3, 1);
            border-radius: 2px;
            box-shadow: 0 0 10px var(--accent-glow);
        }

        .progress-text {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.7rem;
            color: var(--text-dim);
            text-align: center;
            margin-top: 0.75rem;
            letter-spacing: 0.05em;
        }

        /* Question Screen */
        .question-container {
            background: var(--bg-card);
            padding: 2rem;
            border-radius: 16px;
            border: 1px solid var(--border);
        }

        .question-number {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.7rem;
            color: var(--accent);
            margin-bottom: 1rem;
            text-transform: uppercase;
            letter-spacing: 0.15em;
        }

        .question-text {
            font-family: 'Instrument Serif', Georgia, serif;
            font-size: 1.35rem;
            font-weight: 400;
            margin-bottom: 2rem;
            line-height: 1.5;
            color: var(--text);
        }

        /* Answer Options */
        .options {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .option {
            padding: 1.25rem 1.5rem;
            border: 1px solid var(--border);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.16, 1, 0.3, 1);
            font-size: 0.95rem;
            line-height: 1.6;
            background: var(--bg-elevated);
            color: var(--text-secondary);
        }

        .option:hover {
            border-color: var(--border-light);
            background: var(--bg-card);
            color: var(--text);
            transform: translateX(4px);
        }

        .option.selected {
            border-color: var(--accent);
            background: var(--accent-glow);
            color: var(--text);
        }

        .option.selected .option-letter {
            color: var(--accent);
        }

        .option-letter {
            font-family: 'JetBrains Mono', monospace;
            font-weight: 500;
            color: var(--text-dim);
            margin-right: 0.75rem;
            font-size: 0.85rem;
        }

        /* Question Navigation */
        .question-nav {
            display: flex;
            justify-content: space-between;
            margin-top: 2rem;
            padding-top: 1.5rem;
            border-top: 1px solid var(--border);
        }

        /* Results Screen */
        .results-header {
            text-align: center;
            margin-bottom: 2.5rem;
        }

        .results-header h2 {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.7rem;
            font-weight: 400;
            color: var(--text-dim);
            text-transform: uppercase;
            letter-spacing: 0.2em;
            margin-bottom: 0.5rem;
        }

        .results-header p {
            color: var(--text-dim);
            font-size: 0.85rem;
        }

        .primary-result {
            background: linear-gradient(135deg, var(--bg-card) 0%, var(--bg-elevated) 100%);
            border: 1px solid var(--accent);
            padding: 3rem 2rem;
            border-radius: 20px;
            text-align: center;
            margin-bottom: 2rem;
            position: relative;
            overflow: hidden;
        }

        .primary-result::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(ellipse at top, var(--accent-glow) 0%, transparent 60%);
            pointer-events: none;
        }

        .primary-result .ideology-name {
            font-family: 'Instrument Serif', Georgia, serif;
            font-size: 2rem;
            font-weight: 400;
            margin-bottom: 0.5rem;
            position: relative;
            color: var(--text);
        }

        .primary-result .ideology-family {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.75rem;
            color: var(--accent);
            text-transform: uppercase;
            letter-spacing: 0.15em;
            position: relative;
        }

        .result-section {
            background: var(--bg-card);
            padding: 2rem;
            border-radius: 16px;
            border: 1px solid var(--border);
            margin-bottom: 1.5rem;
        }

        .result-section h3 {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.7rem;
            font-weight: 500;
            margin-bottom: 1.25rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border);
            color: var(--accent);
            text-transform: uppercase;
            letter-spacing: 0.15em;
        }

        .result-section p {
            margin-bottom: 1rem;
            color: var(--text-secondary);
        }

        .result-section p:last-child {
            margin-bottom: 0;
        }

        .secondary-match {
            background: var(--bg-elevated);
            padding: 1.25rem;
            border-radius: 10px;
            margin-top: 1.25rem;
            border: 1px solid var(--border);
        }

        .secondary-match strong {
            font-weight: 500;
            color: var(--text);
        }

        /* Axis Scores Visual */
        .axis-scores {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .axis-score-row {
            display: grid;
            grid-template-columns: 100px 1fr 40px;
            gap: 1rem;
            align-items: start;
        }

        .axis-label {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.75rem;
            font-weight: 500;
            color: var(--accent);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            padding-top: 0.25rem;
        }

        .axis-bar-container {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }

        .axis-endpoints {
            display: flex;
            justify-content: space-between;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.7rem;
            color: var(--text-dim);
        }

        .axis-bar {
            height: 10px;
            background: var(--border);
            border-radius: 5px;
            position: relative;
        }

        .axis-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-dim), var(--accent));
            border-radius: 5px;
            transition: width 0.6s cubic-bezier(0.16, 1, 0.3, 1);
            box-shadow: 0 0 15px var(--accent-glow);
        }

        .axis-marker {
            position: absolute;
            top: -3px;
            width: 4px;
            height: 16px;
            background: var(--text);
            border-radius: 2px;
            transform: translateX(-50%);
            box-shadow: 0 0 6px rgba(0,0,0,0.5);
        }

        .axis-desc-row {
            display: flex;
            justify-content: space-between;
            font-size: 0.7rem;
            color: var(--text-dim);
            margin-top: 0.15rem;
        }

        .axis-desc-left {
            text-align: left;
            max-width: 45%;
        }

        .axis-desc-right {
            text-align: right;
            max-width: 45%;
        }

        .axis-score-value {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
            font-weight: 500;
            color: var(--accent);
            text-align: right;
            padding-top: 0.25rem;
        }

        /* Key Thinkers & Examples */
        .thinkers-list {
            font-style: italic;
            color: var(--text-dim);
        }

        /* Reflection Section */
        .reflection-section {
            margin-top: 2.5rem;
        }

        .reflection-section h3 {
            font-family: 'Instrument Serif', Georgia, serif;
            font-size: 1.5rem;
            font-weight: 400;
            margin-bottom: 1.25rem;
            color: var(--text);
        }

        .reflection-prompt {
            background: var(--bg-elevated);
            padding: 1.5rem;
            border-radius: 12px;
            margin-bottom: 1rem;
            border: 1px solid var(--border);
        }

        .reflection-prompt p {
            margin-bottom: 0.5rem;
            color: var(--text-secondary);
            font-size: 0.95rem;
        }

        .reflection-prompt label {
            display: block;
            color: var(--text);
            margin-bottom: 0.5rem;
        }

        .reflection-textarea {
            width: 100%;
            padding: 1rem;
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text);
            font-family: 'Outfit', sans-serif;
            font-size: 0.95rem;
            resize: vertical;
            min-height: 100px;
            margin-top: 0.75rem;
            transition: border-color 0.2s ease;
        }

        .reflection-textarea:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 2px var(--accent-glow);
        }

        .reflection-textarea::placeholder {
            color: var(--text-dim);
        }

        .section-intro {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-bottom: 1rem;
            line-height: 1.5;
        }

        .result-description-box,
        .result-connection-box {
            background: var(--bg-elevated);
            padding: 1.25rem;
            border-radius: 10px;
            border-left: 3px solid var(--accent);
        }

        .result-description-box p,
        .result-connection-box p {
            margin: 0;
            line-height: 1.6;
        }

        .learn-more-box {
            background: var(--bg-elevated);
            padding: 1.25rem;
            border-radius: 10px;
            border-left: 3px solid var(--accent);
        }

        .learn-more-box a {
            color: var(--accent);
            text-decoration: none;
            border-bottom: 1px solid var(--accent-light);
            transition: border-color 0.2s;
        }

        .learn-more-box a:hover {
            border-bottom-color: var(--accent);
        }

        .learn-more-box ul {
            margin: 0.5rem 0 0 0;
            padding-left: 1.25rem;
        }

        .learn-more-box li {
            margin-bottom: 0.5rem;
        }

        .submit-section h3 {
            font-family: 'Instrument Serif', Georgia, serif;
            font-size: 1.5rem;
            font-weight: 400;
            margin-bottom: 0.75rem;
            color: var(--text);
        }

        .btn-large {
            padding: 1rem 2rem;
            font-size: 1.1rem;
        }

        .submit-status {
            margin-top: 1rem;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .submit-status.success {
            color: var(--accent);
        }

        .submit-status.error {
            color: #ff6b6b;
        }

        .reflection-prompt p:last-child {
            margin-bottom: 0;
        }

        .reflection-prompt strong {
            color: var(--text);
            font-weight: 500;
        }

        /* Resume Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.85);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 1.5rem;
        }
        
        .modal-overlay.active {
            display: flex;
        }
        
        .modal-content {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 2rem;
            max-width: 400px;
            width: 100%;
            text-align: center;
        }
        
        .modal-content h2 {
            font-family: 'Instrument Serif', Georgia, serif;
            font-size: 1.5rem;
            font-weight: 400;
            margin-bottom: 1rem;
        }
        
        .modal-content p {
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
            font-size: 0.95rem;
        }
        
        .modal-content .resume-details {
            background: var(--bg-elevated);
            padding: 1rem;
            border-radius: 8px;
            margin: 1.5rem 0;
            text-align: left;
        }
        
        .modal-content .resume-details p {
            margin-bottom: 0.25rem;
        }
        
        .modal-content .resume-details strong {
            color: var(--accent);
            font-weight: 500;
        }
        
        .modal-buttons {
            display: flex;
            gap: 1rem;
            margin-top: 1.5rem;
        }
        
        .modal-buttons .btn {
            flex: 1;
        }
        
        .modal-buttons-stacked {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            margin-top: 1.5rem;
        }
        
        .modal-buttons-row {
            display: flex;
            gap: 0.75rem;
        }
        
        .modal-buttons-row .btn {
            flex: 1;
        }
        
        .modal-buttons-stacked > .btn {
            width: 100%;
        }
        
        /* Save Code Display */
        .save-code-display {
            margin: 1.5rem 0;
        }
        
        .save-code-display textarea {
            width: 100%;
            background: var(--bg-elevated);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 1rem;
            color: var(--text);
            font-family: 'JetBrains Mono', 'Courier New', monospace;
            font-size: 0.75rem;
            resize: none;
            word-break: break-all;
        }
        
        .save-code-display textarea:focus {
            outline: none;
            border-color: var(--accent);
        }
        
        /* Save Code Link on Welcome Screen */
        .save-code-link {
            margin-top: 1.5rem;
            text-align: center;
        }
        
        .save-code-link a {
            color: var(--text-secondary);
            font-size: 0.9rem;
            text-decoration: underline;
            text-underline-offset: 3px;
        }
        
        .save-code-link a:hover {
            color: var(--accent);
        }
        
        /* Ghost Button Style */
        .btn-ghost {
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text-secondary);
            padding: 0.5rem 1rem;
            font-size: 0.85rem;
        }
        
        .btn-ghost:hover {
            border-color: var(--accent);
            color: var(--accent);
            background: rgba(201, 246, 111, 0.1);
        }

        /* Submit Button States */
        .btn.submitted {
            background: #2d5a3e;
            cursor: default;
        }
        
        .btn.submitted:hover {
            transform: none;
            box-shadow: none;
        }
        
        .submit-section {
            background: var(--accent-glow);
            border: 1px solid var(--accent);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            text-align: center;
        }
        
        .submit-section p {
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-bottom: 1rem;
        }

        /* Print Styles */
        .print-section {
            margin-top: 2.5rem;
            padding-top: 2rem;
            border-top: 1px solid var(--border);
            text-align: center;
        }

        .print-section p {
            color: var(--text-dim);
            font-size: 0.85rem;
            margin-bottom: 1.25rem;
        }

        @media print {
            body {
                background: white;
                color: black;
            }
            
            .btn, .print-section, .progress-container {
                display: none !important;
            }
            
            .container {
                max-width: 100%;
            }
            
            .screen {
                display: block !important;
            }
            
            #welcome-screen, #preamble-screen, #question-screen {
                display: none !important;
            }

            .primary-result, .result-section, .reflection-prompt {
                border: 1px solid #ccc;
                background: white;
            }
        }

        /* Glossary Tooltips */
        .glossary-term {
            border-bottom: 1px dotted var(--accent);
            cursor: help;
            position: relative;
        }

        .glossary-tooltip {
            display: none;
            position: absolute;
            bottom: calc(100% + 8px);
            left: 50%;
            transform: translateX(-50%);
            background: var(--bg-card);
            border: 1px solid var(--accent);
            border-radius: 8px;
            padding: 0.75rem 1rem;
            font-size: 0.85rem;
            line-height: 1.5;
            color: var(--text-secondary);
            width: max-content;
            max-width: 280px;
            z-index: 1000;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .glossary-tooltip::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 8px solid transparent;
            border-top-color: var(--accent);
        }

        .glossary-term.active .glossary-tooltip {
            display: block;
        }

        @media (hover: hover) {
            .glossary-term:hover .glossary-tooltip {
                display: block;
            }
        }

        @media (max-width: 600px) {
            .glossary-tooltip {
                position: fixed;
                bottom: auto;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                max-width: 85vw;
            }
            
            .glossary-tooltip::after {
                display: none;
            }
        }

        /* Mobile Adjustments */
        @media (max-width: 600px) {
            .container {
                padding: 1.25rem;
            }

            header {
                padding: 2rem 0 1.5rem;
            }

            h1 {
                font-size: 1.75rem;
            }

            .question-text {
                font-size: 1.15rem;
            }

            .question-container {
                padding: 1.5rem;
            }

            .option {
                padding: 1rem 1.25rem;
                font-size: 0.9rem;
            }

            .option:hover {
                transform: none;
            }

            .btn {
                padding: 0.875rem 1.5rem;
                width: 100%;
            }

            .btn-row {
                flex-direction: column;
            }

            .axis-score-row {
                grid-template-columns: 1fr;
                gap: 0.5rem;
            }

            .primary-result {
                padding: 2rem 1.5rem;
            }

            .primary-result .ideology-name {
                font-size: 1.5rem;
            }

            .result-section {
                padding: 1.5rem;
            }
        }

        /* Loading state */
        .loading {
            text-align: center;
            padding: 3rem;
            color: var(--text-dim);
        }

        /* Student name input */
        .name-input-group {
            margin-bottom: 2rem;
        }
        
        .input-hint {
            display: block;
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin-top: 0.4rem;
            font-style: italic;
        }

        /* Subtle animations */
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .progress-fill {
            animation: none;
        }

        /* Focus visible for accessibility */
        .btn:focus-visible,
        .option:focus-visible,
        textarea:focus-visible,
        input:focus-visible {
            outline: 2px solid var(--accent);
            outline-offset: 2px;
        }
    </style>
</head>
<body>
    <!-- Resume Progress Modal -->
    <div id="resume-modal" class="modal-overlay">
        <div class="modal-content">
            <h2>Welcome Back</h2>
            <p>You have saved progress on this assessment.</p>
            
            <div class="resume-details">
                <p><strong>Name:</strong> <span id="resume-name"></span></p>
                <p><strong>Progress:</strong> <span id="resume-progress"></span></p>
                <p><span id="resume-date"></span></p>
            </div>
            
            <div class="modal-buttons">
                <button class="btn btn-secondary" onclick="startFresh()">Start Over</button>
                <button id="resume-btn" class="btn btn-primary" onclick="resumeProgress()">Continue</button>
            </div>
        </div>
    </div>

    <!-- Save Code Modal -->
    <div id="save-code-modal" class="modal-overlay">
        <div class="modal-content">
            <h2>ðŸ’¾ Your Save Code</h2>
            <p>Use this code to continue on any device. Email it to yourself or copy it somewhere safe.</p>
            
            <div class="save-code-display">
                <textarea id="save-code-text" readonly rows="4" onclick="this.select()"></textarea>
            </div>
            
            <div class="modal-buttons-stacked">
                <button class="btn btn-primary" id="email-code-btn" onclick="emailSaveCode()" style="display: none;">ðŸ“§ Email to me</button>
                <div class="modal-buttons-row">
                    <button class="btn btn-secondary" onclick="closeSaveCodeModal()">Close</button>
                    <button class="btn btn-ghost" onclick="copySaveCode()">ðŸ“‹ Copy Code</button>
                </div>
            </div>
            <p class="copy-confirm" id="copy-confirm" style="display: none; color: var(--accent); margin-top: 0.5rem;">âœ“ Copied to clipboard!</p>
        </div>
    </div>

    <!-- Load Code Modal -->
    <div id="load-code-modal" class="modal-overlay">
        <div class="modal-content">
            <h2>ðŸ“‚ Load Save Code</h2>
            <p>Paste your save code below to continue where you left off on another device.</p>
            
            <div class="save-code-display">
                <textarea id="load-code-text" rows="4" placeholder="Paste your save code here..."></textarea>
            </div>
            
            <p class="load-error" id="load-error" style="display: none; color: #ff6b6b; margin-top: 0.5rem;"></p>
            
            <div class="modal-buttons">
                <button class="btn btn-secondary" onclick="closeLoadCodeModal()">Cancel</button>
                <button class="btn btn-primary" onclick="loadFromCode()">Load Progress</button>
            </div>
        </div>
    </div>

    <div class="container">
        <header>
            <h1>Political Ideology Assessment</h1>
            <p class="subtitle">Social Studies 10</p>
        </header>

        <!-- Welcome Screen -->
        <div id="welcome-screen" class="screen active">
            <div class="intro-text">
                <p>This assessment will help you understand where your political beliefs sit in relation to various ideological traditions. There are no right or wrong answers: only your honest perspectives.</p>
                
                <p>Over the past few weeks, you've explored different political ideologies through debates and discussions. Now it's time to reflect on where <em>you</em> stand.</p>
            </div>

            <div class="note-box">
                <strong>How this works:</strong> You'll first reflect on what you <em>think</em> your ideology might be, then answer 50 scenario-based questions. Each question presents a situation with four possible responses. Choose the one closest to how you actually think, not what you think you "should" say.
            </div>

            <div class="note-box">
                <strong>Time needed:</strong> About 25-35 minutes. Take your time with each question.
            </div>
            
            <div class="note-box">
                <strong>Saving your progress:</strong> Your answers are automatically saved to this browser as you go. If you close the tab or lose internet, just come back to this page on the same device and your progress will be waiting. Need to switch devices or finish on a different computer? Use the "Get Save Code" button during the quiz to generate a code you can enter here later.
            </div>

            <div class="note-box">
                <strong>Need help with a word?</strong> Some words have a <span style="border-bottom: 1px dotted var(--accent);">dotted underline</span>. Tap or hover on them to see a quick definition.
            </div>

            <div class="name-input-group">
                <label for="student-name">Your Name</label>
                <input type="text" id="student-name" placeholder="Enter your name for the reflection">
            </div>
            
            <div class="name-input-group">
                <label for="student-email">Your School Email</label>
                <input type="email" id="student-email" placeholder="yourname@deltalearns.ca">
                <span class="input-hint">Used to send yourself a save code if you need to finish later</span>
            </div>

            <button class="btn btn-primary" onclick="startPreamble()">Begin Assessment</button>
            
            <div class="save-code-link">
                <a href="#" onclick="showLoadCodeModal(); return false;">Have a save code from another device?</a>
            </div>
        </div>

        <!-- Preamble Screen -->
        <div id="preamble-screen" class="screen">
            <div class="preamble-section">
                <h2>Before You Begin: Your Predictions</h2>
                <p style="margin-bottom: 1.5rem;">Before taking the test, reflect on what you already think about your political beliefs. This isn't about being "right": it's about having something to compare your results to.</p>

                <div class="form-group">
                    <label for="preamble-ideology">Which of the ideologies we've covered do you think you most align with right now? Why does this one speak to you?</label>
                    <textarea id="preamble-ideology" rows="4" placeholder="Describe which ideology you think fits you best and what attracts you to it..."></textarea>
                </div>
            </div>

            <div class="preamble-section">
                <h2>Where Do You Think You Fall?</h2>
                <p style="margin-bottom: 1.5rem;">For each of these dimensions, briefly explain which direction you lean and why.</p>

                <div class="axis-group">
                    <h3>Economic: Equality â†” Markets</h3>
                    <p class="axis-description"><strong>Equality:</strong> The economy should be structured to minimize inequality, even if that requires significant government intervention or collective ownership.<br><strong>Markets:</strong> Free markets and private property are the best way to organize the economy; government intervention usually makes things worse.</p>
                    <textarea id="axis-economic" rows="3" placeholder="Which way do you lean and why?"></textarea>
                </div>

                <div class="axis-group">
                    <h3>State: More Government â†” Less Government</h3>
                    <p class="axis-description"><strong>More:</strong> Government is a useful tool for solving collective problems, providing services, and ensuring fairness.<br><strong>Less:</strong> Government is often inefficient, coercive, or serves the powerful; we should minimize its role or rely on alternative forms of organization.</p>
                    <textarea id="axis-state" rows="3" placeholder="Which way do you lean and why?"></textarea>
                </div>

                <div class="axis-group">
                    <h3>Change: Preserve â†” Transform</h3>
                    <p class="axis-description"><strong>Preserve:</strong> Existing institutions and traditions carry wisdom; change should be cautious and gradual.<br><strong>Transform:</strong> Fundamental change is needed; the current system has deep problems that can't be fixed with small reforms.</p>
                    <textarea id="axis-change" rows="3" placeholder="Which way do you lean and why?"></textarea>
                </div>

                <div class="axis-group">
                    <h3>Agency: Individual â†” Collective</h3>
                    <p class="axis-description"><strong>Individual:</strong> Change happens through individual choices and personal responsibility; collective solutions often backfire.<br><strong>Collective:</strong> Most problems require collective action; individual solutions can't address systemic issues.</p>
                    <textarea id="axis-agency" rows="3" placeholder="Which way do you lean and why?"></textarea>
                </div>
            </div>

            <div class="btn-row">
                <button class="btn btn-secondary" onclick="backToWelcome()">Back</button>
                <button class="btn btn-primary" onclick="startQuestions()">Continue to Questions</button>
            </div>
        </div>

        <!-- Question Screen -->
        <div id="question-screen" class="screen">
            <div class="progress-container">
                <div class="progress-bar">
                    <div class="progress-fill" id="progress-fill"></div>
                </div>
                <div class="progress-text" id="progress-text">Question 1 of 50</div>
            </div>

            <div class="question-container">
                <div class="question-number" id="question-category">Economy & Markets</div>
                <div class="question-text" id="question-text">Loading question...</div>
                
                <div class="options" id="options-container">
                    <!-- Options will be inserted here -->
                </div>
            </div>

            <div class="question-nav">
                <button class="btn btn-secondary" id="prev-btn" onclick="prevQuestion()">Previous</button>
                <button class="btn btn-ghost" id="save-code-btn" onclick="showSaveCodeModal()">ðŸ’¾ Save Code</button>
                <button class="btn btn-primary" id="next-btn" onclick="nextQuestion()">Next</button>
            </div>
        </div>

        <!-- Results Screen -->
        <div id="results-screen" class="screen">
            <div class="results-header">
                <h2>Your Results</h2>
                <p>Based on your responses to 50 questions</p>
            </div>

            <div class="primary-result">
                <div class="ideology-name" id="result-ideology">Loading...</div>
                <div class="ideology-family" id="result-family">Broader tradition: Loading...</div>
            </div>

            <div class="result-section">
                <h3>What This Means</h3>
                <p class="section-intro">This describes the political perspective your answers most closely match. Remember: this is a starting point for reflection, not a final label.</p>
                <div id="result-description" class="result-description-box">Loading description...</div>
            </div>

            <div class="result-section">
                <h3>Key Thinkers & Movements</h3>
                <p><strong>Thinkers who shaped this tradition:</strong></p>
                <p class="thinkers-list" id="result-thinkers">Loading...</p>
                <p style="margin-top: 1rem;"><strong>Where you might see these ideas today:</strong></p>
                <p id="result-examples" style="color: var(--text-secondary);">Loading...</p>
            </div>

            <div class="result-section">
                <h3>Learn More</h3>
                <p class="section-intro">Want to dig deeper? Here are some starting points:</p>
                <div id="learn-more-links" class="learn-more-box">Loading...</div>
            </div>

            <div class="result-section">
                <h3>Connection to Our Class</h3>
                <p class="section-intro">How this connects to the ideology debates and discussions we've had:</p>
                <div id="result-connection" class="result-connection-box">Loading...</div>
            </div>

            <div class="result-section">
                <h3>Canadian Political Parties</h3>
                <p class="section-intro">How does this ideology relate to actual Canadian politics? Remember: no party perfectly represents any ideology, and parties change over time. This is a rough guide, not an endorsement.</p>
                <div id="canadian-parties-content" class="result-description-box">Loading...</div>
            </div>

            <div class="result-section">
                <h3>Your Axis Scores</h3>
                <p class="section-intro">These six dimensions show different aspects of political thinking. The marker shows where you scored from 1 (left description) to 5 (right description). Most people don't score at the extremes.</p>
                <div class="axis-scores" id="axis-scores-display">
                    <!-- Axis scores will be inserted here -->
                </div>
            </div>

            <div class="result-section" id="secondary-result-section">
                <h3>Also Consider</h3>
                <div class="secondary-match" id="secondary-match">
                    <p><strong id="secondary-ideology">Loading...</strong></p>
                    <p id="secondary-description">Loading description...</p>
                </div>
            </div>

            <div class="reflection-section">
                <h3>Reflection Questions</h3>
                <p class="section-intro">Answer these questions to complete your assessment. Aim for 3-5 thoughtful sentences per question. Your responses will be submitted with your results.</p>

                <div class="reflection-prompt">
                    <label for="reflection-1"><strong>1. Compare your prediction to your result.</strong> <em>(3-5 sentences)</em></label>
                    <p>Before the test, you predicted you would align with a particular ideology. How does your actual result compare? Were you surprised? What might explain any differences?</p>
                    <textarea id="reflection-1" class="reflection-textarea" placeholder="Type your response here..." rows="4"></textarea>
                </div>

                <div class="reflection-prompt">
                    <label for="reflection-2"><strong>2. Examine your axis scores.</strong> <em>(3-5 sentences)</em></label>
                    <p>Look at where you fell on each dimension. Which scores feel most accurate to you? Are there any that surprise you or that you'd want to think more about?</p>
                    <textarea id="reflection-2" class="reflection-textarea" placeholder="Type your response here..." rows="4"></textarea>
                </div>

                <div class="reflection-prompt">
                    <label for="reflection-3"><strong>3. Questions that made you think.</strong> <em>(3-5 sentences)</em></label>
                    <p>Were there any questions where you found it genuinely difficult to choose? What made them hard? What does that difficulty reveal about your values or about the complexity of political questions?</p>
                    <textarea id="reflection-3" class="reflection-textarea" placeholder="Type your response here..." rows="4"></textarea>
                </div>

                <div class="reflection-prompt">
                    <label for="reflection-4"><strong>4. Connecting to the debates.</strong> <em>(3-5 sentences)</em></label>
                    <p>How does your result connect to the positions argued in our ideology debates? If you were assigned to argue for a different ideology than your result, what was that experience like?</p>
                    <textarea id="reflection-4" class="reflection-textarea" placeholder="Type your response here..." rows="4"></textarea>
                </div>

                <div class="reflection-prompt">
                    <label for="reflection-5"><strong>5. Limitations and growth.</strong> <em>(3-5 sentences)</em></label>
                    <p>No test can fully capture someone's political beliefs. What important aspects of your thinking do you feel this assessment missed? How might your views continue to develop?</p>
                    <textarea id="reflection-5" class="reflection-textarea" placeholder="Type your response here..." rows="4"></textarea>
                </div>
            </div>

            <div class="submit-section">
                <h3>Submit Your Assessment</h3>
                <p>Click below to send your results and reflections to your teacher. This completes the assignment.</p>
                <button id="submit-btn" class="btn btn-primary btn-large" onclick="submitToTeacher()">
                    ðŸ“¤ Submit Results & Reflections
                </button>
                <p id="submit-status" class="submit-status"></p>
            </div>

            <div class="print-section">
                <p style="margin-bottom: 1rem; color: var(--text-secondary);">Want a copy for yourself?</p>
                <button class="btn btn-secondary" onclick="window.print()">Print Results</button>
                <button class="btn btn-secondary" onclick="downloadResults()" style="margin-left: 1rem;">Download as Text</button>
            </div>
        </div>
    </div>

    <script>
    // ==================== DATA ====================
    
    const ideologies = {
        "traditional-conservative": {
            name: "Traditional Conservative",
            family: "Conservative",
            profile: [1.5, 2, 1, 1.5, 2, 1.5],
            summary: "You value inherited institutions, gradual organic change, and social stability. You're skeptical of rapid reform, believing that communities, families, and traditions (not the state) should address social problems. You see markets as embedded in moral and cultural contexts, not as ends in themselves.",
            thinkers: "Edmund Burke, Roger Scruton, Michael Oakeshott",
            examples: "Some Red Tories in Canada, traditional wings of Conservative parties, communitarian conservatives",
            connection: "In our debates, this position often emphasized the wisdom embedded in existing practices and the risks of radical change. You likely found yourself skeptical of both socialist transformation AND pure free-market ideology, preferring organic community bonds.",
            canadianParties: "<strong>Closest match:</strong> The traditional or 'Red Tory' wing of the <strong>Conservative Party of Canada</strong>, though this tradition has weakened since the 1990s merger with the Reform/Alliance. Some older PC supporters now vote Liberal. <strong>Note:</strong> Modern CPC often leans more libertarian-economic than traditional conservatism would prefer."
        },
        "paternalistic-conservative": {
            name: "Paternalistic Conservative (Red Tory)",
            family: "Conservative",
            profile: [2, 2.5, 2, 2, 2, 2],
            summary: "You combine conservative social values with a belief that the state has genuine obligations to citizens' welfare. You support social programs as expressions of national community and mutual obligation (not socialist redistribution, but noblesse oblige. You're critical of both socialism and unfettered capitalism.",
            thinkers: "Benjamin Disraeli, George Grant, Phillip Blond",
            examples: "Canadian Red Tory tradition, 'One Nation' Conservatives in the UK, some Christian Democrats",
            connection: "This position bridges conservative and social democratic territory. You share the conservative respect for tradition but believe the community (including through government) has real responsibilities to its members.",
            canadianParties: "<strong>Closest match:</strong> You're a political orphan in modern Canada. The old <strong>Progressive Conservative</strong> tradition represented this view, but it largely disappeared after the 2003 merger. Some Red Tories vote CPC, others Liberal, some NDP. The <strong>Conservative Party</strong> occasionally nods to this tradition but rarely governs this way."
        },
        "fiscal-conservative": {
            name: "Fiscal Conservative",
            family: "Conservative",
            profile: [1, 1.5, 1.5, 1.5, 1.5, 2],
            summary: "You prioritize balanced budgets, low taxes, and limited government spending. You may be moderate on social issues, but you believe economic freedom is foundational to all other freedoms. You're skeptical of government's ability to solve problems efficiently and worry about debt burdens on future generations.",
            thinkers: "Milton Friedman (economic influence), fiscal hawks across parties",
            examples: "Mainstream Conservative Party fiscal policy, deficit hawks, small-government advocates",
            connection: "In debates about government programs, you likely emphasized costs, efficiency, and unintended consequences. Your concern isn't necessarily with helping people, but with whether government programs actually achieve their goals.",
            canadianParties: "<strong>Closest match:</strong> The <strong>Conservative Party of Canada</strong>, particularly on economic policy. The <strong>Liberals</strong> sometimes talk fiscal responsibility but rarely prioritize it. <strong>Note:</strong> If you're socially progressive but fiscally conservative, you may feel unrepresented, as both major parties bundle economic and social positions."
        },
        "national-conservative": {
            name: "National Conservative",
            family: "Conservative",
            profile: [2, 2.5, 1, 2, 2, 1],
            summary: "You emphasize national identity, cultural cohesion, and sovereignty. You support state intervention to protect national industry and culture, and you're skeptical of globalization and international institutions. You're not necessarily economically libertarian: you'll use the state to serve national interests.",
            thinkers: "Yoram Hazony, various nationalist intellectuals",
            examples: "Some European conservative parties, sovereigntist movements, economic nationalists",
            connection: "Your internationalism score is notably low: you see national borders and identity as meaningful and worth protecting. This sets you apart from both liberal internationalists and socialist internationalists.",
            canadianParties: "<strong>Closest match:</strong> Elements of the <strong>Conservative Party</strong> (immigration skepticism, sovereignty focus) and the <strong>Bloc QuÃ©bÃ©cois</strong> (Quebec nationalism specifically). The <strong>People's Party of Canada</strong> emphasizes national sovereignty but pairs it with more libertarian economics than you might prefer."
        },
        "right-libertarian": {
            name: "Right-Libertarian",
            family: "Conservative/Libertarian",
            profile: [1, 1, 2, 1, 1, 2],
            summary: "You believe in maximum economic and personal freedom. The state should be minimal, protecting only life, liberty, and property. You see taxation as coercive and believe markets solve problems better than governments. Individual choice is paramount, both in economics and personal life.",
            thinkers: "Robert Nozick, Friedrich Hayek, Ayn Rand, Murray Rothbard",
            examples: "Libertarian Party, some People's Party of Canada positions, free-market think tanks",
            connection: "You consistently favored market solutions and individual responsibility across questions. Your skepticism extends to government in general, not just economic intervention. You might have found common ground with anarchists on state skepticism, but differ sharply on economics.",
            canadianParties: "<strong>Closest match:</strong> The <strong>People's Party of Canada</strong> comes closest, though even they aren't fully libertarian. Some <strong>Conservative Party</strong> members hold these views. <strong>Honest truth:</strong> Canada has no truly libertarian party with significant representation. You'll likely feel every party is too statist."
        },
        "classical-liberal": {
            name: "Classical Liberal",
            family: "Liberal",
            profile: [1.5, 1.5, 2, 2, 1.5, 2.5],
            summary: "You represent the foundational liberal tradition: individual rights, rule of law, free markets, and limited government. You believe liberty is best protected by constraining state power. You support free trade and international cooperation based on mutual benefit and shared rules.",
            thinkers: "John Locke, Adam Smith, John Stuart Mill",
            examples: "Some business liberals, free-trade advocates, classical liberal think tanks",
            connection: "In our discussions of state power, you likely emphasized limits and checks. You share some ground with right-libertarians but are more comfortable with a modest state role and international institutions.",
            canadianParties: "<strong>Closest match:</strong> The business-friendly wing of the <strong>Liberal Party</strong>, or the more moderate wing of the <strong>Conservative Party</strong>. You're economically right but socially moderate, which puts you between the two major parties. <strong>Note:</strong> Neither party is purely classically liberal, both intervene in the economy more than you'd prefer."
        },
        "social-liberal": {
            name: "Social Liberal",
            family: "Liberal",
            profile: [2.5, 2.5, 2.5, 2.5, 2.5, 3],
            summary: "You believe meaningful freedom requires the material conditions to exercise it. You support a market economy with significant regulation, a social safety net, and strong civil liberties. Government should ensure equal opportunity and basic welfare (not equality of outcome, but a fair starting point.",
            thinkers: "John Rawls, John Dewey, T.H. Green",
            examples: "Mainstream Liberal Party of Canada, US Democrats (centre), European liberal parties",
            connection: "This is often considered the 'centre' position in Canadian politics. You want to address inequality and social problems, but through reform within capitalism rather than replacing it. You likely found yourself between conservative and socialist positions in debates.",
            canadianParties: "<strong>Closest match:</strong> The <strong>Liberal Party of Canada</strong> is literally named after your ideology. This is their mainstream position. <strong>However:</strong> The Liberals often campaign from the left and govern from the right. Watch what they do, not just what they say. If you want slightly more social programs, the <strong>NDP</strong> is worth considering."
        },
        "progressive-liberal": {
            name: "Progressive Liberal",
            family: "Liberal",
            profile: [2.5, 3, 3, 3, 3, 3],
            summary: "You emphasize using government actively to address inequality, discrimination, and social problems. You have a strong focus on civil rights, identity-based justice, and institutional reform. Markets are acceptable but need significant oversight and correction.",
            thinkers: "Contemporary progressive movement, various social justice advocates",
            examples: "Progressive wing of Liberal Party, some NDP-Liberal overlap areas",
            connection: "You push further than social liberals on addressing structural problems, but still work within existing institutions. You're reform-oriented but ambitious about how much reform is needed.",
            canadianParties: "<strong>Closest match:</strong> You're in the overlap zone between <strong>Liberal</strong> and <strong>NDP</strong>. The progressive wing of the Liberals or the moderate wing of the NDP both speak to your values. <strong>Consider:</strong> Strategic voting may appeal to you, but pay attention to whether promises translate to action."
        },
        "neoliberal": {
            name: "Neoliberal",
            family: "Liberal",
            profile: [1.5, 2, 2, 2, 2, 3],
            summary: "You believe markets are the most efficient allocators of resources, and government's role is to create conditions for markets to function well. You support free trade, deregulation, and privatization where it improves efficiency. Unlike classical liberals, you accept an active state role in constructing and maintaining markets.",
            thinkers: "Gary Becker, James Buchanan, various policy economists",
            examples: "'Third Way' economics, 1990s-2000s mainstream policy consensus, market-oriented reformers",
            connection: "This ideology has been dominant in policy circles for decades. You trust market mechanisms and worry that government intervention, while sometimes necessary, often creates more problems than it solves.",
            canadianParties: "<strong>Closest match:</strong> Both the <strong>Liberal Party</strong> and <strong>Conservative Party</strong> have governed with neoliberal policies since the 1980s (privatization, free trade, austerity). The Liberals under ChrÃ©tien/Martin and the Conservatives under Harper both fit this mold. <strong>Note:</strong> 'Neoliberal' is often used as a criticism, but if the shoe fits..."
        },
        "nordic-social-democrat": {
            name: "Nordic Social Democrat",
            family: "Social Democratic",
            profile: [3, 3.5, 3, 3.5, 3, 3.5],
            summary: "You believe in a strong welfare state, high taxes, and universal social programs, but within a market economy. Capitalism can be tamed through regulation and redistribution. Strong unions and tripartite bargaining between government, business, and labour create shared prosperity.",
            thinkers: "Olof Palme, Ernst Wigforss, Nordic social democratic tradition",
            examples: "Scandinavian social democratic parties, some NDP positions, universal program advocates",
            connection: "In our debates, this position argued that you can have both markets and equality through smart policy. You're not trying to abolish capitalism, but to civilize it through robust public institutions.",
            canadianParties: "<strong>Closest match:</strong> The <strong>NDP</strong> at its best, especially when pushing universal programs (pharmacare, childcare, dental). <strong>Reality check:</strong> Canada has never achieved Nordic-level social democracy. Our unions are weaker, our taxes lower, our welfare state more threadbare. You might vote NDP while pushing them to be bolder. Provincial NDP governments in BC, Manitoba, and historically Saskatchewan come closest."
        },
        "third-way-social-democrat": {
            name: "Third Way Social Democrat",
            family: "Social Democratic",
            profile: [2.5, 3, 2.5, 2.5, 3, 3],
            summary: "You accept the market economy more fully than traditional social democrats. You focus on 'equality of opportunity' over equality of outcomes, emphasizing education, skills training, and 'active labour market policies' rather than direct redistribution. You're pragmatic about what government can achieve.",
            thinkers: "Anthony Giddens, Tony Blair, Bill Clinton's policy advisors",
            examples: "1990s-2000s Labour in the UK, some NDP modernizers, 'New Democrats'",
            connection: "This represents social democracy after it made peace with markets. You want to help people succeed in the market economy, not fundamentally restructure it.",
            canadianParties: "<strong>Closest match:</strong> The federal <strong>NDP</strong> under some leaders, or the rightward edge of NDP policy. Also some <strong>Liberal</strong> governments when they actually deliver on social promises. <strong>Note:</strong> Third Way politics dominated the 1990s-2000s but has been criticized for abandoning workers. Consider whether these parties actually fight for your interests or just manage decline."
        },
        "left-social-democrat": {
            name: "Left Social Democrat",
            family: "Social Democratic",
            profile: [3.5, 3.5, 3.5, 3.5, 3.5, 3.5],
            summary: "You represent traditional social democracy with more ambitious redistribution and a stronger critique of capitalism. You're open to expanding public ownership beyond just services. You see social democracy as potentially transitional toward something more transformative, and you're skeptical of Third Way compromises.",
            thinkers: "Tony Benn, Bernie Sanders, Jeremy Corbyn",
            examples: "Left-wing of NDP, Corbyn-era Labour, democratic socialist-adjacent movements",
            connection: "You push social democracy toward its socialist roots. You want more than a safety net: you want to shift power from capital to workers and communities, but through democratic means.",
            canadianParties: "<strong>Closest match:</strong> The left wing of the <strong>NDP</strong>, particularly when they push for pharmacare, dental care, and stronger labour rights. The <strong>BC NDP</strong> provincially sometimes governs this way. <strong>Frustration alert:</strong> You may find the NDP too timid, too willing to compromise, too focused on electability over principle. Many left social democrats feel politically homeless."
        },
        "democratic-socialist": {
            name: "Democratic Socialist",
            family: "Socialist",
            profile: [4, 3.5, 4, 4, 4, 4],
            summary: "You believe capitalism must be replaced, not just regulated, but through democratic means, not authoritarian ones. You support expanding worker ownership, public ownership of key industries, and economic democracy. The goal is a fundamentally different economy where working people control their workplaces and communities.",
            thinkers: "Michael Harrington, Rosa Luxemburg, contemporary DSA thinkers",
            examples: "Democratic Socialists of America, Jacobin magazine, left-NDP positions",
            connection: "In our debates, you likely argued that social democratic reforms, while good, don't go far enough. The problem isn't just distribution: it's who owns and controls the economy in the first place.",
            canadianParties: "<strong>Honest answer:</strong> No major Canadian party represents democratic socialism. The <strong>NDP</strong> abandoned socialism in its 2013 constitution. You might vote NDP as harm reduction while building power outside electoral politics. <strong>Consider:</strong> Labour organizing, tenant unions, mutual aid, and socialist organizations may matter more than voting for a party that doesn't share your goals."
        },
        "marxist": {
            name: "Marxist",
            family: "Socialist",
            profile: [4.5, 4, 4.5, 4.5, 4, 4.5],
            summary: "You analyze society through class struggle and historical materialism. Capitalism is inherently exploitative and crisis-prone (these aren't bugs that can be fixed, but features of the system. The working class must organize to transform society. You may vary on questions of state, party, and revolution.",
            thinkers: "Karl Marx, Friedrich Engels, various Marxist traditions (Lenin, Gramsci, etc.)",
            examples: "Various Marxist parties and tendencies, Marxist academics and journals",
            connection: "Your analysis goes to the root (that's what 'radical' means). You see the class struggle we discussed not as one issue among many, but as the fundamental conflict shaping society.",
            canadianParties: "<strong>Honest answer:</strong> No parliamentary party represents Marxism. The <strong>Communist Party of Canada</strong> exists but is tiny. <strong>Your options:</strong> Some Marxists vote NDP tactically while organizing in workplaces and communities. Others focus entirely on building working-class power outside elections. The question isn't 'which party?' but 'how do we build the movement that could actually change things?'"
        },
        "market-socialist": {
            name: "Market Socialist",
            family: "Socialist",
            profile: [4, 3, 3.5, 4, 3.5, 3.5],
            summary: "You believe in worker ownership of enterprises, but with coordination through markets rather than central planning. You think you can have the efficiency and dynamism of markets without capitalist ownership. Firms would be democratically run by workers, competing and cooperating in a market.",
            thinkers: "David Schweickart, John Roemer, Alec Nove",
            examples: "Mondragon cooperative model as inspiration, worker cooperative movements",
            connection: "You want to democratize the economy without abandoning markets entirely. This position tries to take the best of both systems while avoiding the worst of each.",
            canadianParties: "<strong>Closest match:</strong> No party, but the <strong>NDP</strong> occasionally supports cooperative development. <strong>Your path:</strong> Consider supporting and building worker cooperatives directly. Organizations like the Canadian Worker Co-op Federation do more for market socialism than any party. Electoral politics matters less here than economic organizing."
        },
        "eco-socialist": {
            name: "Eco-Socialist",
            family: "Socialist",
            profile: [4.5, 3.5, 4.5, 4.5, 4, 4.5],
            summary: "You believe capitalism's growth imperative is incompatible with ecological survival. The environmental crisis requires system change, not 'green capitalism.' Climate justice is class justice: the same systems that exploit workers exploit nature. We need fundamentally different ways of producing and living.",
            thinkers: "John Bellamy Foster, Naomi Klein, Andreas Malm",
            examples: "Green-left movements, climate justice activists, Sunrise Movement left wing",
            connection: "In our climate discussions, you likely argued that individual action and market solutions aren't enough. The problem is systemic, and so must be the solution.",
            canadianParties: "<strong>Closest match:</strong> The <strong>Green Party</strong> talks ecology but isn't socialist. The <strong>NDP</strong> is somewhat socialist but weak on ecology. Neither party offers eco-socialism. <strong>Your path:</strong> Climate justice movements, Indigenous land defenders, and direct action may matter more than any party. Consider groups like Extinction Rebellion, Indigenous Climate Action, or local climate justice coalitions."
        },
        "anarcho-communist": {
            name: "Anarcho-Communist",
            family: "Anarchist",
            profile: [4.6, 4.7, 4.6, 4.6, 4.6, 4.6],
            summary: "You believe we should abolish both capitalism and the state. Common ownership of the means of production, distribution based on need, voluntary association, mutual aid. All hierarchical authority (whether economic, political, or social) is illegitimate and must be dismantled.",
            thinkers: "Peter Kropotkin, Emma Goldman, Errico Malatesta",
            examples: "Historical Spanish CNT-FAI, some contemporary anarchist movements, mutual aid networks",
            connection: "You push the critique of hierarchy to its logical conclusion. Unlike Marxists, you don't see the state as a tool that can be used for liberation: it's part of the problem.",
            canadianParties: "<strong>Honest answer:</strong> No party. Anarchists don't believe in electoral politics as a path to change. <strong>Your path:</strong> Mutual aid networks, tenant organizing, workplace organizing, direct action, building alternatives now. Some anarchists vote tactically to prevent the worst outcomes, others refuse on principle. The important thing is building power from below, not waiting for politicians to save us."
        },
        "anarcho-syndicalist": {
            name: "Anarcho-Syndicalist",
            family: "Anarchist",
            profile: [4.6, 4.7, 4.4, 4.4, 4.5, 4.5],
            summary: "You see worker unions as both the vehicle for revolution and the basis for future society. The general strike is a key tactic. Workplace organization is both means and end: workers organizing at the point of production can shut down capitalism and build alternatives simultaneously.",
            thinkers: "Rudolf Rocker, CNT-FAI tradition",
            examples: "IWW (Industrial Workers of the World), radical union movements",
            connection: "Your focus on workplace organizing connects to our discussions of unions and worker power. But you go further: unions aren't just for better wages, they're the embryo of a new society.",
            canadianParties: "<strong>Honest answer:</strong> No party. Your focus is workplace organizing, not elections. <strong>Your path:</strong> The <strong>IWW (Industrial Workers of the World)</strong> has Canadian branches. Radical caucuses within mainstream unions push for more militant tactics. The goal is building worker power that doesn't depend on politicians. Some syndicalists might tactically support the NDP during labour disputes, but the real action is in the workplace."
        },
        "mutualist": {
            name: "Mutualist",
            family: "Anarchist",
            profile: [4.2, 4.7, 4.2, 4.2, 4.4, 4.3],
            summary: "You support markets without capitalism. You believe in individual possession (not absentee ownership), mutual banks, and voluntary exchange. You oppose both state socialism and capitalism. Markets are acceptable if they're not based on exploitation, if workers own their tools and can access credit freely.",
            thinkers: "Pierre-Joseph Proudhon (the first person to call himself an anarchist)",
            examples: "Some market anarchists, cooperative movement influence, alternative currency advocates",
            connection: "You're skeptical of both state solutions and capitalist ownership. You imagine a decentralized economy of worker-owners exchanging freely, without landlords, bosses, or bureaucrats.",
            canadianParties: "<strong>Honest answer:</strong> No party represents mutualism. You're skeptical of both state and capital. <strong>Your path:</strong> Building cooperatives, credit unions, alternative economic structures. Some mutualists engage with the <strong>Green Party</strong> on decentralization, others with cooperative movements. The point is creating the economy you want directly, not asking politicians for permission."
        },
        "social-anarchist": {
            name: "Social Anarchist",
            family: "Anarchist",
            profile: [4.4, 4.7, 4.4, 4.4, 4.5, 4.5],
            summary: "You represent the broad anarchist tradition emphasizing mutual aid, direct democracy, and opposition to all hierarchy. You believe in prefigurative politics: building the new world in the shell of the old. You're flexible on organizational questions but firm on anti-hierarchy.",
            thinkers: "Murray Bookchin (earlier work), Colin Ward, David Graeber",
            examples: "Occupy movement, housing cooperatives, Food Not Bombs, mutual aid networks",
            connection: "In our debates, you likely emphasized direct action and building alternatives over electoral politics. You don't want to take state power: you want to make it irrelevant.",
            canadianParties: "<strong>Honest answer:</strong> Electoral politics isn't your game. <strong>Your path:</strong> Food Not Bombs, mutual aid networks, tenant unions, cop-watch, community defense, building the world you want now. Some social anarchists vote tactically, others don't. What matters is the work you do between elections: building community power that doesn't depend on state permission."
        },
        "green-anarchist": {
            name: "Green Anarchist",
            family: "Anarchist",
            profile: [4.5, 4.7, 4.6, 4.4, 4.5, 4.5],
            summary: "You combine anarchism with deep ecology. Industrial civilization itself may be the problem (not just capitalism, but the whole project of dominating nature. You advocate bioregionalism, small-scale communities, and harmony with the living world.",
            thinkers: "Murray Bookchin's social ecology, some deep ecologists",
            examples: "Environmental direct action movements, back-to-the-land movements, eco-villages",
            connection: "Your environmental score was very high, and you combine it with anarchist politics. You see the domination of nature and the domination of people as connected: both must end.",
            canadianParties: "<strong>Honest answer:</strong> The <strong>Green Party</strong> isn't radical enough and isn't anarchist. <strong>Your path:</strong> Land defense, Indigenous solidarity (with respect for Indigenous leadership), direct action against pipelines and extraction, building sustainable alternatives. Groups like Extinction Rebellion (the more radical factions), forest defense camps, and eco-village movements align more closely than any party."
        },
        "communitarian": {
            name: "Communitarian",
            family: "Cross-Cutting",
            profile: [2.5, 2.5, 2, 2.5, 2, 2],
            summary: "You emphasize community bonds, shared values, and mutual obligations over pure individualism. You're critical of both libertarianism (for atomizing society) and some progressive liberalism (for the same reason). Strong communities, not just individuals or the state, should be the basis of social life.",
            thinkers: "Alasdair MacIntyre, Michael Sandel, Charles Taylor",
            examples: "Some 'post-liberal' thinkers, communitarian policy proposals, localist movements",
            connection: "You resist being placed on a left-right spectrum because your primary concern is the health of community life, which both market fundamentalism and state centralism can threaten.",
            canadianParties: "<strong>Complicated:</strong> You don't fit neatly anywhere. Elements of the <strong>Conservative Party</strong> (community, tradition) and <strong>NDP</strong> (solidarity, mutual obligation) speak to different parts of your view. You might vote based on local community issues rather than national ideology. <strong>Consider:</strong> Municipal politics and community organizing may matter more to you than federal parties."
        },
        "left-libertarian": {
            name: "Left-Libertarian",
            family: "Cross-Cutting",
            profile: [3.5, 4, 4, 4, 4.5, 4.5],
            summary: "You combine strong civil liberties with left economics. You're anti-authoritarian but not fully anarchist. You support decentralization, direct democracy, and worker control. You're skeptical of both big government and big capital: you want power distributed to communities and workplaces.",
            thinkers: "Noam Chomsky, various libertarian socialist thinkers",
            examples: "Some green-left movements, libertarian municipal movements, Rojava experiment",
            connection: "You share the anarchist suspicion of concentrated power but might be more pragmatic about using some state structures during transition. You're libertarian about means but socialist about ends.",
            canadianParties: "<strong>Closest match:</strong> No good options. The <strong>NDP</strong> isn't libertarian enough; the <strong>Green Party</strong> isn't socialist enough. <strong>Your path:</strong> You might vote NDP or Green tactically while organizing outside electoral politics. Movements for democratic reform (proportional representation, direct democracy) and workplace democracy matter more than any current party."
        },
        "techno-progressive": {
            name: "Techno-Progressive",
            family: "Cross-Cutting",
            profile: [3, 3, 4, 3.5, 3, 4],
            summary: "You believe technology, including AI and automation, can be harnessed for liberation, if it's democratically controlled. You support UBI, public ownership of AI, and using technology to reduce work. You're neither technophobic nor uncritically techno-optimist: the question is who controls technology and for what purpose.",
            thinkers: "Aaron Bastani, Nick Srnicek, Paul Mason",
            examples: "'Fully Automated Luxury Communism' discourse, some tech policy advocates, post-work theorists",
            connection: "In our AI and automation discussions, you likely saw both promise and danger. Automation under capitalism threatens workers, but automation under democratic control could free us from drudgery.",
            canadianParties: "<strong>Closest match:</strong> No party has a coherent techno-progressive platform. The <strong>NDP</strong> sometimes talks about taxing tech giants; the <strong>Greens</strong> sometimes talk about UBI. <strong>Your path:</strong> Push for public ownership of AI infrastructure, UBI experiments, and democratic control of technology through whatever political channels exist. This is an emerging ideology without clear party representation yet."
        }
    };

    const questions = [
        // ECONOMY & MARKETS (Q1-Q10)
        {
            id: 1,
            category: "Economy & Markets",
            text: "A factory in your community announces it's closing because it's no longer profitable. 200 workers will lose their jobs. What should happen?",
            options: [
                { text: "The owner made a business decision they're entitled to make. Workers should look for new jobs or retrain for other industries.", scores: [1, 1, 2, 1, 1, 2] },
                { text: "Government should offer incentives to keep it open, or provide job retraining and unemployment support for affected workers.", scores: [2.5, 3, 3, 3, 3, 2.5] },
                { text: "The workers should have the right to buy the factory and run it themselves as a cooperative, with government loans to help.", scores: [4, 3.5, 4, 4, 4, 3.5] },
                { text: "The workers and community should simply take it over and run it themselves. Why should one person's 'ownership' on paper outweigh 200 people's livelihoods? Property that affects whole communities should be controlled by those communities, not abandoned for profit.", scores: [5, 5, 5, 5, 5, 5] }
            ]
        },
        {
            id: 2,
            category: "Economy & Markets",
            text: "The minimum wage debate continues. What's your view?",
            options: [
                { text: "Wages should be determined by the market. Minimum wage laws cause unemployment by making some workers too expensive to hire.", scores: [1, 1, 2, 1, 1, 2] },
                { text: "A reasonable minimum wage is necessary to ensure workers can meet basic needs, though it shouldn't be so high it hurts small businesses.", scores: [2.5, 2.5, 2.5, 2.5, 2.5, 2.5] },
                { text: "Minimum wage should be a living wage, tied to local cost of living and automatically adjusted. Workers deserve dignity.", scores: [3.5, 3.5, 3.5, 3.5, 3, 3] },
                { text: "The whole concept of wages is the problem: selling your labour to someone who profits from it. Workplaces should be owned and run by workers themselves, sharing the value they create directly.", scores: [5, 5, 5, 5, 5, 5] }
            ]
        },
        {
            id: 3,
            category: "Economy & Markets",
            text: "Home prices have risen 47% since 2020, and first-time homebuyers have dropped to a record low of 21% of purchases. The median age of first-time buyers is now 40. What's the best response?",
            options: [
                { text: "Reduce regulations on building so developers can build more housing. Increasing supply will lower prices naturally.", scores: [1, 1.5, 2, 2, 1.5, 2] },
                { text: "A mix of approaches: some new regulations on speculation, incentives for affordable housing, and programs to help first-time buyers.", scores: [2.5, 3, 2.5, 2.5, 2.5, 2.5] },
                { text: "Housing is too important to leave to the market. We need significant public housing, rent control, and restrictions on treating housing as an investment.", scores: [3.5, 3.5, 3.5, 3.5, 3.5, 3] },
                { text: "Housing should not be a commodity at all. Shelter is a human need, not an investment vehicle. Communities should control land through land trusts and housing cooperatives, taking it off the speculative market entirely.", scores: [5, 5, 5, 5, 5, 5] }
            ]
        },
        {
            id: 4,
            category: "Economy & Markets",
            text: "A new report shows that the wealth of billionaires has doubled in the past decade while inflation-adjusted median wages grew only 12% over nearly 20 years. Your reaction?",
            options: [
                { text: "Billionaires create wealth, jobs, and innovation. Their success benefits everyone through the economy. We shouldn't punish success.", scores: [1, 1, 1.5, 1, 1, 2] },
                { text: "Some inequality is natural, but this is excessive. We should close tax loopholes and ensure the wealthy pay their fair share.", scores: [2, 2, 2.5, 2, 2, 2.5] },
                { text: "This level of inequality is harmful to democracy and society. We need wealth taxes, inheritance taxes, and much stronger redistribution.", scores: [3.5, 3.5, 3.5, 4, 3.5, 3.5] },
                { text: "Billionaires shouldn't exist. You can't accumulate that much wealth without exploitation. The entire system of private ownership that allows this needs to be dismantled and replaced with collective ownership.", scores: [5, 5, 5, 5, 5, 5] }
            ]
        },
        {
            id: 5,
            category: "Economy & Markets",
            text: "Your provincial government is considering selling a public electricity company to a private corporation. What do you think?",
            options: [
                { text: "Private companies are usually more efficient than government ones. This will probably lower costs and improve service.", scores: [1, 1.5, 2, 1.5, 1.5, 2] },
                { text: "It depends on the specifics. Privatization can work for some services but essential utilities might need to stay public.", scores: [2, 2, 2, 2, 2, 2] },
                { text: "Essential services like electricity should remain public. Private companies prioritize profit over universal service.", scores: [3.5, 3.5, 2.5, 3.5, 3, 2.5] },
                { text: "Essential utilities should be run by the communities that use them, not by corporations or distant governments. Worker and community cooperatives, not state bureaucracies or private monopolies.", scores: [5, 5, 5, 5, 5, 5] }
            ]
        },
        {
            id: 6,
            category: "Economy & Markets",
            text: "When thinking about the economy, which do you find yourself more concerned about?",
            options: [
                { text: "Over-regulation that makes it hard for anyone to start and run a business. We need more economic freedom.", scores: [1, 1, 2, 1.5, 1, 2] },
                { text: "Making sure small businesses can compete fairly against large corporations, while maintaining reasonable consumer protections.", scores: [2, 2, 2, 2, 2, 2] },
                { text: "Corporate power and concentration. Big businesses have too much influence over our economy and our politics.", scores: [3.5, 3, 3.5, 3.5, 3, 3] },
                { text: "The problem isn't big vs. small business: it's the whole system of private ownership of workplaces. Workers should control their own labour.", scores: [4.5, 4, 4.5, 4.5, 4.5, 4] }
            ]
        },
        {
            id: 7,
            category: "Economy & Markets",
            text: "A trade deal is proposed that would reduce tariffs and increase trade with other countries. What's your view?",
            options: [
                { text: "Free trade benefits everyone through lower prices and greater choice. We should embrace global markets.", scores: [1.5, 2, 2, 2, 2, 3] },
                { text: "Trade deals should be balanced: protecting some key industries while opening others. The details matter.", scores: [2, 2.5, 2, 2, 2.5, 2.5] },
                { text: "Trade deals often prioritize corporate interests over workers and the environment. We need trade that serves people, not capital.", scores: [3.5, 3, 3.5, 3.5, 3.5, 3.5] },
                { text: "'Free trade' under capitalism means freedom for capital to exploit workers wherever labour is cheapest. We need international worker solidarity, not corporate trade deals.", scores: [4.5, 4, 4.5, 4.5, 4.5, 5] }
            ]
        },
        {
            id: 8,
            category: "Economy & Markets",
            text: "A wealthy person dies and leaves $50 million to their children, who did nothing to earn it. What should happen?",
            options: [
                { text: "People should be able to pass on what they've earned to their children. It's their money. High inheritance taxes discourage saving and building.", scores: [1, 1, 1, 1, 1, 1.5] },
                { text: "Some inheritance is reasonable, but very large inheritances should be taxed more heavily to prevent aristocratic dynasties forming.", scores: [2.5, 2.5, 2.5, 2.5, 2, 2.5] },
                { text: "Large inheritances entrench inequality across generations. We should have substantial inheritance taxes to fund public goods.", scores: [3.5, 3.5, 3.5, 4, 3, 3] },
                { text: "No one should inherit massive wealth. Society creates wealth collectively, and it should return to the commons when people die.", scores: [5, 4, 5, 5, 4, 4] }
            ]
        },
        {
            id: 9,
            category: "Economy & Markets",
            text: "The economy enters a recession. Unemployment rises sharply. What should the government do?",
            options: [
                { text: "Reduce taxes and regulations to stimulate business activity. Let the market recover naturally without interference.", scores: [1, 1, 2, 1, 1, 2] },
                { text: "Provide unemployment insurance, some stimulus spending, and support for affected businesses, but don't overdo it.", scores: [2, 2.5, 2.5, 2.5, 2.5, 2.5] },
                { text: "Major government investment in jobs, infrastructure, and social programs. This is when people need the state most.", scores: [3.5, 4, 3.5, 3.5, 3.5, 3] },
                { text: "Economic crises reveal capitalism's fundamental instability. We should use this as an opportunity to build alternative economic structures: cooperatives, public ownership, community wealth.", scores: [4.5, 4, 5, 4.5, 4.5, 4] }
            ]
        },
        {
            id: 10,
            category: "Economy & Markets",
            text: "What's your view on profit as a motivator in the economy?",
            options: [
                { text: "Profit is what drives innovation, efficiency, and growth. It rewards people for providing what others want.", scores: [1, 1, 2, 1.5, 1, 2] },
                { text: "Profit is useful but needs to be balanced with other values like sustainability, fairness, and social good.", scores: [2.5, 2.5, 2.5, 2.5, 2.5, 2.5] },
                { text: "Profit often conflicts with human needs. We need strong regulations to ensure businesses serve society, not just shareholders.", scores: [3.5, 3.5, 3.5, 3.5, 3, 3] },
                { text: "The profit motive is fundamentally about extracting value from workers and nature. We should organize production for human needs, not profit.", scores: [5, 4, 5, 5, 4.5, 4] }
            ]
        },
        // STATE & GOVERNMENT (Q11-Q18)
        {
            id: 11,
            category: "State & Government",
            text: "How much do you trust government to solve social problems?",
            options: [
                { text: "Very little. Government is usually inefficient and often makes things worse. Private and community solutions work better.", scores: [1.5, 1, 2, 2, 1.5, 2] },
                { text: "Government has a role, but it should be limited. It's best at setting rules, not running things.", scores: [2, 2, 2, 2, 2, 2] },
                { text: "Democratic government is the best tool we have for collective action. It should be robust and well-funded.", scores: [3, 3.5, 3, 3, 3.5, 3] },
                { text: "All states serve the powerful. We need to build horizontal, community-controlled alternatives: mutual aid, worker cooperatives, neighbourhood assemblies. Not better rulers, but no rulers.", scores: [5, 5, 5, 5, 5, 5] }
            ]
        },
        {
            id: 12,
            category: "State & Government",
            text: "What's your view on the role of police in society?",
            options: [
                { text: "Police are essential for maintaining order and protecting property and persons. We should support law enforcement.", scores: [1.5, 1.5, 1, 1.5, 1.5, 1.5] },
                { text: "Police are necessary but need reform: better training, accountability, and community oversight.", scores: [2, 2.5, 2.5, 2.5, 2.5, 2.5] },
                { text: "We should shift significant resources from police to social services that address root causes of crime: poverty, mental health, addiction.", scores: [3.5, 3.5, 3.5, 4, 3.5, 3.5] },
                { text: "Police exist primarily to protect property and maintain hierarchies. We should work toward community-based safety that doesn't rely on armed enforcement.", scores: [5, 5, 5, 5, 5, 4.5] }
            ]
        },
        {
            id: 13,
            category: "State & Government",
            text: "An election is coming up. What's your view on electoral politics?",
            options: [
                { text: "Voting is the cornerstone of democracy. We should focus on electing good representatives who will govern wisely.", scores: [2, 2, 2, 2, 2.5, 2] },
                { text: "Voting matters, but our system needs reform: proportional representation, getting money out of politics, making it easier to vote.", scores: [2.5, 3, 3, 3, 3, 3] },
                { text: "Electoral politics is important but limited. Real change requires organized pressure from social movements, unions, and communities.", scores: [3.5, 3.5, 3.5, 3.5, 4, 3.5] },
                { text: "Elections offer a choice between managers of the same system. Real democracy means people making decisions directly about their own lives, not choosing which politicians rule them.", scores: [5, 5, 5, 5, 5, 5] }
            ]
        },
        {
            id: 14,
            category: "State & Government",
            text: "Where should political power mainly reside?",
            options: [
                { text: "Local communities and provinces should have more power. The federal government is too distant and one-size-fits-all.", scores: [2, 1.5, 2, 2, 2, 1.5] },
                { text: "A balance: federal government for national issues, but significant local autonomy for community decisions.", scores: [2.5, 2.5, 2.5, 2.5, 2.5, 2.5] },
                { text: "Strong federal standards are needed to ensure equality across regions. Otherwise, some provinces will fall behind.", scores: [3, 3.5, 3, 3, 3.5, 3] },
                { text: "Power should belong to communities and workplaces directly: neighbourhood assemblies, worker councils, voluntary federation from the bottom up. Not top-down government at any level.", scores: [5, 5, 5, 5, 5, 5] }
            ]
        },
        {
            id: 15,
            category: "State & Government",
            text: "What's your general view on taxation?",
            options: [
                { text: "Taxes are necessary but should be kept as low as possible. They discourage productivity and people spend their own money more wisely.", scores: [1, 1, 1.5, 1, 1, 2] },
                { text: "We need moderate taxes to fund essential services, but we should be careful not to overtax and hurt the economy.", scores: [2, 2, 2, 2, 2, 2.5] },
                { text: "Higher taxes on the wealthy and corporations are needed to fund robust public services and reduce inequality.", scores: [3.5, 3.5, 3.5, 4, 3, 3.5] },
                { text: "Taxation assumes a system where wealth is privately accumulated and then partially redistributed. With common ownership of production, we wouldn't need to claw back what should never have been hoarded.", scores: [5, 5, 5, 5, 5, 5] }
            ]
        },
        {
            id: 16,
            category: "State & Government",
            text: "A new environmental regulation would require a company to reduce pollution but would increase their costs. Your view?",
            options: [
                { text: "Regulations like this hurt businesses and cost jobs. We should let companies decide how to balance profit and environment.", scores: [1, 1, 2, 1.5, 1, 2] },
                { text: "Some regulation is needed, but it should be balanced and consider economic impacts. Maybe phase it in gradually.", scores: [2, 2.5, 2.5, 2.5, 2.5, 2.5] },
                { text: "The environment must be protected. Companies should internalize the costs of their pollution rather than passing them to society.", scores: [3.5, 3.5, 3.5, 3.5, 3, 3.5] },
                { text: "Private companies will always prioritize profit over ecology. Communities affected by pollution should have direct democratic control over production decisions in their area, not beg corporations or governments for protection.", scores: [5, 5, 5, 5, 5, 5] }
            ]
        },
        {
            id: 17,
            category: "State & Government",
            text: "What's the best way to organize healthcare?",
            options: [
                { text: "Market-based healthcare with private insurance gives people choice and drives innovation. Government healthcare is inefficient.", scores: [1, 1, 2, 1, 1, 2] },
                { text: "A mixed system works best: public coverage for essential services, with private options for those who want them.", scores: [2, 2.5, 2, 2, 2, 2.5] },
                { text: "Universal public healthcare is a right. Everyone deserves quality care regardless of ability to pay. Single-payer is the way.", scores: [3.5, 4, 3, 3.5, 3.5, 3] },
                { text: "Healthcare should be completely decommodified: no profit motive at all. Hospitals, pharma, everything should be publicly owned and democratically controlled.", scores: [5, 4.5, 4.5, 5, 4, 4] }
            ]
        },
        {
            id: 18,
            category: "State & Government",
            text: "What's the appropriate role for a country's military?",
            options: [
                { text: "A strong military is essential for national security and protecting our interests. Peace comes through strength.", scores: [2, 2, 1.5, 2, 2, 1] },
                { text: "We need a military for defence, but we should be cautious about interventions and prioritize diplomacy.", scores: [2, 2.5, 2.5, 2, 2.5, 2.5] },
                { text: "Military spending is excessive. We should redirect resources to human needs and focus on international cooperation.", scores: [3.5, 3.5, 3.5, 3.5, 3, 4] },
                { text: "National militaries primarily serve capitalist and imperialist interests. We should work toward disarmament and global demilitarization.", scores: [4.5, 4.5, 5, 4.5, 4.5, 5] }
            ]
        },
        // WORK & LABOUR (Q19-Q26)
        {
            id: 19,
            category: "Work & Labour",
            text: "A group of workers at a company wants to form a union. The company opposes it. What's your view?",
            options: [
                { text: "Workers and employers should both be free to negotiate. Unions sometimes help workers, but they can also hurt businesses and limit flexibility.", scores: [1.5, 2, 2, 2, 1.5, 2] },
                { text: "Workers have a right to organize, but unions should work cooperatively with employers toward mutual benefit.", scores: [2.5, 2.5, 2.5, 2.5, 3, 2.5] },
                { text: "Strong unions are essential for worker power. Workers should have robust protections for organizing.", scores: [3.5, 3.5, 3.5, 4, 4, 3.5] },
                { text: "Unions are good but don't go far enough. Workers shouldn't just negotiate with owners: they should be the owners.", scores: [4.5, 4, 4.5, 4.5, 4.5, 4] }
            ]
        },
        {
            id: 20,
            category: "Work & Labour",
            text: "Apps like Uber and DoorDash classify workers as 'independent contractors' rather than employees. What do you think?",
            options: [
                { text: "This is flexible work that many people prefer. Workers can set their own hours. Over-regulating would destroy these opportunities.", scores: [1, 1, 2, 1, 1, 2] },
                { text: "There should be some basic protections for gig workers, but we also shouldn't eliminate flexibility that some workers value.", scores: [2, 2.5, 2.5, 2, 2, 2.5] },
                { text: "This is exploitation disguised as freedom. These companies avoid providing benefits and protections that employees deserve.", scores: [3.5, 3.5, 4, 4, 3.5, 3] },
                { text: "The gig economy shows how capitalism constantly finds new ways to exploit labour. Workers should organize and create platform cooperatives they own themselves.", scores: [4.5, 4, 4.5, 4.5, 5, 4] }
            ]
        },
        {
            id: 21,
            category: "Work & Labour",
            text: "Who should make major decisions at a company (like what to produce, who to hire, and how to distribute profits)?",
            options: [
                { text: "Owners and shareholders take the financial risk, so they should have decision-making power. That's how investment works.", scores: [1, 1.5, 2, 1, 1, 2] },
                { text: "Management makes most decisions, but workers should have input through representation on boards or consultation processes.", scores: [2.5, 2.5, 2.5, 2.5, 2.5, 2.5] },
                { text: "Workers should have much more say. They're the ones who actually do the work and their lives are most affected.", scores: [4, 3.5, 4, 4, 4, 3.5] },
                { text: "Workers should control their workplaces directly through democratic assemblies, no bosses, no owners. Hierarchy itself is the problem.", scores: [5, 5, 5, 5, 5, 5] }
            ]
        },
        {
            id: 22,
            category: "Work & Labour",
            text: "What's your view on the value of hard work?",
            options: [
                { text: "Hard work is how you get ahead. Success comes to those who work for it. Everyone should take personal responsibility.", scores: [1.5, 1.5, 1.5, 1, 1, 1.5] },
                { text: "Hard work is important, but we also need to ensure opportunity is fair. Working hard should lead to a decent life.", scores: [2.5, 2.5, 2.5, 2.5, 2, 2.5] },
                { text: "Many people work incredibly hard and still struggle. The problem isn't work ethic: it's a system that doesn't reward labour fairly.", scores: [3.5, 3.5, 3.5, 4, 3.5, 3.5] },
                { text: "'Work ethic' is ideology that makes workers blame themselves for class exploitation. We should work to live, not live to work. Imagine if we shared the necessary labour and all had time for what matters.", scores: [5, 5, 5, 5, 5, 5] }
            ]
        },
        {
            id: 23,
            category: "Work & Labour",
            text: "What's the main cause of unemployment?",
            options: [
                { text: "Mostly individual factors: skills mismatch, unwillingness to relocate, or insufficient motivation. The economy provides opportunities for those who seek them.", scores: [1, 1.5, 2, 1, 1, 2] },
                { text: "A mix of structural and individual factors. We need better education and training to match people with available jobs.", scores: [2.5, 2.5, 2.5, 2.5, 2, 2.5] },
                { text: "Primarily structural: the economy doesn't create enough good jobs, and too much power rests with employers.", scores: [3.5, 3.5, 3.5, 4, 3.5, 3.5] },
                { text: "Unemployment is built into capitalism: a 'reserve army' that keeps workers scared and wages low. In a society organized around human need, everyone who wanted to contribute could.", scores: [5, 5, 5, 5, 5, 5] }
            ]
        },
        {
            id: 24,
            category: "Work & Labour",
            text: "CEOs of large companies now earn about 280 times what their median worker earns, up from 21 times in 1965. What's your reaction?",
            options: [
                { text: "If a CEO creates that much value for the company, they deserve high pay. The market sets compensation.", scores: [1, 1, 2, 1, 1, 2] },
                { text: "Some gap is justified, but this ratio seems excessive. There should be more transparency and perhaps some limits.", scores: [2.5, 2.5, 2.5, 2.5, 2.5, 2.5] },
                { text: "This is obscene. No one's work is worth 300 times more than another's. We need policies to narrow this gap.", scores: [3.5, 3.5, 4, 4.5, 3, 3] },
                { text: "This reveals who capitalism serves. The whole concept of CEOs, of people paid to command others, is the problem. Workers running their own workplaces would never vote anyone a 300x salary.", scores: [5, 5, 5, 5, 5, 5] }
            ]
        },
        {
            id: 25,
            category: "Work & Labour",
            text: "Workers at a public transit company go on strike, disrupting commuters. Your reaction?",
            options: [
                { text: "Public sector strikes should be restricted. It holds the public hostage. Workers should accept arbitration instead.", scores: [1.5, 2, 1.5, 1.5, 1.5, 1.5] },
                { text: "Workers have a right to strike, but essential services are different. There should be limits or required minimum service.", scores: [2.5, 2.5, 2, 2, 2.5, 2.5] },
                { text: "Strikes are inconvenient but necessary. The disruption is the point: it's the only leverage workers have.", scores: [3.5, 3.5, 3.5, 4, 4, 3.5] },
                { text: "Support all workers in struggle. An injury to one is an injury to all. Don't blame workers for fighting back. Blame the system that forces them to strike for dignity.", scores: [5, 5, 5, 5, 5, 5] }
            ]
        },
        {
            id: 26,
            category: "Work & Labour",
            text: "In an ideal society, what would be the purpose of work?",
            options: [
                { text: "To provide for yourself and your family through productive contribution. Work gives life meaning and structure.", scores: [1.5, 2, 1.5, 1.5, 1, 1.5] },
                { text: "To contribute to society while earning a living. Work should be balanced with leisure and family.", scores: [2.5, 2.5, 2, 2.5, 2, 2.5] },
                { text: "Everyone should be able to work in ways that are meaningful to them, with dignity and fair compensation.", scores: [3.5, 3.5, 3.5, 3.5, 3.5, 3.5] },
                { text: "In a truly free society, the distinction between 'work' and meaningful activity would dissolve. We'd contribute freely to our communities, not sell our time to survive. From each according to ability, to each according to need.", scores: [5, 5, 5, 5, 5, 5] }
            ]
        },
        // CLIMATE & ENVIRONMENT (Q27-Q34)
        {
            id: 27,
            category: "Climate & Environment",
            text: "What's the best approach to addressing climate change?",
            options: [
                { text: "Technology and markets will solve this. Innovation, carbon pricing, and consumer choice are the way forward without heavy-handed government action.", scores: [1.5, 1.5, 2, 2, 1.5, 2.5] },
                { text: "A balanced approach: some carbon pricing, some investment in green technology, incentives for businesses and consumers to change.", scores: [2.5, 2.5, 2.5, 2.5, 2.5, 3] },
                { text: "Major government investment and regulation. We need a Green New Deal: massive public programs to transform our energy and economy.", scores: [3.5, 4, 4, 3.5, 3.5, 3.5] },
                { text: "Climate change can't be solved under capitalism. The growth imperative and profit motive are incompatible with ecological limits. We need system change.", scores: [5, 4, 5, 5, 4.5, 5] }
            ]
        },
        {
            id: 28,
            category: "Climate & Environment",
            text: "What should happen to the oil and gas industry as we transition to clean energy?",
            options: [
                { text: "The industry should transition at its own pace. Rapid shutdown would devastate workers and communities. Market forces will shift investment over time.", scores: [1, 2, 1.5, 2, 2, 2] },
                { text: "Gradual phase-out with support for affected workers and communities. Transition takes time and we need to manage it.", scores: [2.5, 3, 2.5, 2.5, 2.5, 3] },
                { text: "Aggressive timeline to phase out fossil fuels with major public investment in alternatives and just transition for workers.", scores: [3.5, 4, 4, 3.5, 3.5, 4] },
                { text: "Fossil fuel companies have knowingly caused this crisis and should be held accountable. Nationalize them and wind them down under democratic control.", scores: [5, 4.5, 5, 5, 4, 4.5] }
            ]
        },
        {
            id: 29,
            category: "Climate & Environment",
            text: "When it comes to environmental problems, where should focus be?",
            options: [
                { text: "Individual choices matter most. If everyone made better consumer decisions, we'd solve these problems.", scores: [1.5, 1.5, 2, 1.5, 1, 2] },
                { text: "Both individual and systemic changes are needed. People should do their part while we also push for policy change.", scores: [2.5, 2.5, 2.5, 2.5, 2.5, 2.5] },
                { text: "Systemic change is primary. Individual action is fine but can't substitute for changing how production and energy work.", scores: [3.5, 3.5, 4, 4, 3.5, 3.5] },
                { text: "Focusing on individual choices is a distraction created by corporations. The problem is capitalism's need for endless growth on a finite planet.", scores: [5, 4, 5, 5, 4.5, 4.5] }
            ]
        },
        {
            id: 30,
            category: "Climate & Environment",
            text: "Can we address environmental problems while maintaining economic growth?",
            options: [
                { text: "Absolutely. Growth and environmental protection go together. Innovation creates green growth.", scores: [1.5, 2, 2, 2, 2, 2.5] },
                { text: "We can have sustainable growth if we're smart about it. Green technology and circular economy approaches can help.", scores: [2.5, 2.5, 2.5, 2.5, 2.5, 3] },
                { text: "Endless growth on a finite planet is impossible. We need to rethink what we mean by prosperity and well-being.", scores: [4, 3.5, 4, 4, 3.5, 4] },
                { text: "'Green growth' is an oxymoron. Capitalism requires infinite growth; ecology requires limits. We need an economy organized around human and ecological need, not profit and accumulation.", scores: [5, 5, 5, 5, 5, 5] }
            ]
        },
        {
            id: 31,
            category: "Climate & Environment",
            text: "Some argue climate change is a justice issue. What do you think?",
            options: [
                { text: "Climate change is an environmental and economic issue. Framing it as 'justice' makes it political and divisive.", scores: [2, 2, 1.5, 1.5, 2, 2] },
                { text: "There are justice dimensions: poorer countries and communities are more affected. International cooperation should address this.", scores: [2.5, 3, 2.5, 3, 3, 3.5] },
                { text: "Climate justice is central. Those who caused the crisis should pay, and those most affected should be protected and compensated.", scores: [3.5, 3.5, 4, 4.5, 3.5, 4.5] },
                { text: "Climate change is colonialism and capitalism extended. The same systems that exploited people and lands now threaten the planet. Justice means dismantling those systems, not managing their symptoms.", scores: [5, 5, 5, 5, 5, 5] }
            ]
        },
        {
            id: 32,
            category: "Climate & Environment",
            text: "What's the proper relationship between humans and the natural environment?",
            options: [
                { text: "Humans are part of nature but also distinct: we develop and use natural resources for human benefit, while managing sustainably.", scores: [2, 2, 2, 2, 2, 2] },
                { text: "We need balance. Economic development and environmental protection can coexist with good policy.", scores: [2.5, 2.5, 2.5, 2.5, 2.5, 2.5] },
                { text: "We've prioritized economic growth over ecological health for too long. The environment should have stronger protections even when it limits development.", scores: [3.5, 3.5, 3.5, 3.5, 3, 3.5] },
                { text: "The capitalist view of nature as a 'resource' to exploit is the root problem. We need to live with and within the natural world as part of interconnected ecological communities, not as dominators extracting wealth.", scores: [5, 5, 5, 5, 5, 5] }
            ]
        },
        {
            id: 33,
            category: "Climate & Environment",
            text: "Activists block a road to protest a new pipeline. Your reaction?",
            options: [
                { text: "This is illegal and disrupts ordinary people. Protests should be lawful. Blocking infrastructure crosses a line.", scores: [2, 2, 1.5, 2, 1.5, 2] },
                { text: "I understand their frustration, but there are better ways to make change. Disruptive protests often backfire.", scores: [2.5, 2.5, 2, 2.5, 2.5, 2.5] },
                { text: "When the system isn't responding to a crisis, disruption becomes necessary. Civil disobedience has a long history.", scores: [3.5, 3.5, 4, 3.5, 4, 3.5] },
                { text: "Direct action is often the only thing that gets attention. The real violence is the pipeline itself and the system forcing it through. Full solidarity with those putting their bodies on the line.", scores: [5, 5, 5, 5, 5, 5] }
            ]
        },
        {
            id: 34,
            category: "Climate & Environment",
            text: "When it comes to environmental issues, should we prioritize local or global approaches?",
            options: [
                { text: "Local control is best. Communities know their own needs and environments better than distant bureaucrats.", scores: [2, 1.5, 2, 2, 2, 1.5] },
                { text: "A mix: some issues need local solutions, others need coordinated national or international action.", scores: [2.5, 2.5, 2.5, 2.5, 2.5, 3] },
                { text: "Global problems require global solutions. Strong international agreements and institutions are essential for climate.", scores: [3, 3.5, 3, 3, 3.5, 4] },
                { text: "Global solidarity, but through horizontal networks of communities and movements, not top-down institutions controlled by the same states and corporations causing the crisis. Think globally, organize locally, federate freely.", scores: [5, 5, 5, 5, 5, 5] }
            ]
        },
        // AI & AUTOMATION (Q35-Q42)
        {
            id: 35,
            category: "AI & Automation",
            text: "Goldman Sachs estimates AI could affect 300 million jobs globally. The World Economic Forum (a billionaire-funded organization) claims 92 million jobs will be displaced but 170 million 'created' by 2030, though critics note these new jobs require different skills and may not help displaced workers. What's the best response?",
            options: [
                { text: "Technology creates new jobs even as it eliminates old ones. People should adapt and retrain. This is how progress works.", scores: [1, 1, 1.5, 1, 1, 1.5] },
                { text: "Government should help with transition (retraining programs, education, support for affected workers) while allowing technology to advance.", scores: [2.5, 3, 2.5, 2.5, 2.5, 3] },
                { text: "We need major policies like universal basic income and public job guarantees. The gains from automation should be shared broadly.", scores: [3.5, 4, 4, 4, 3.5, 3.5] },
                { text: "Under capitalism, automation eliminates workers to boost profits. Under worker and community ownership, it could free us from drudgery. The question isn't the technology, it's who owns it.", scores: [5, 5, 5, 5, 5, 5] }
            ]
        },
        {
            id: 36,
            category: "AI & Automation",
            text: "Major AI systems are being developed by a few large tech companies. Who should own and control AI?",
            options: [
                { text: "Private companies develop AI best because they can invest and innovate. Competition drives progress.", scores: [1, 1.5, 2, 1.5, 1, 2] },
                { text: "Private development is fine, but we need regulation to ensure safety and prevent monopolies.", scores: [2, 2.5, 2.5, 2, 2.5, 2.5] },
                { text: "AI is too important to be privately controlled. It should be publicly funded and publicly owned, like a utility.", scores: [4, 4, 4, 4, 3.5, 4] },
                { text: "Truly powerful AI should belong to everyone, developed transparently and democratically, not controlled by corporations or governments.", scores: [5, 4.5, 4.5, 5, 5, 5] }
            ]
        },
        {
            id: 37,
            category: "AI & Automation",
            text: "Universal Basic Income (UBI) is proposed to address automation. What do you think?",
            options: [
                { text: "UBI discourages work and is too expensive. People need opportunities, not handouts.", scores: [1, 1, 2, 1, 1, 2] },
                { text: "UBI might work as part of a broader strategy, but we should start with more targeted programs.", scores: [2.5, 2.5, 2.5, 2.5, 2.5, 2.5] },
                { text: "UBI is a good idea to ensure everyone benefits from productivity gains. It provides security and freedom.", scores: [3.5, 3.5, 4, 4, 3, 3.5] },
                { text: "UBI is a band-aid. The real question is who owns the robots. With worker/public ownership of automated production, we wouldn't need UBI: the wealth would already be shared.", scores: [5, 4, 5, 5, 4, 4.5] }
            ]
        },
        {
            id: 38,
            category: "AI & Automation",
            text: "If AI can do most jobs better than humans, what gives human work value?",
            options: [
                { text: "Human work has intrinsic value through creativity, relationships, and service. There will always be jobs for humans who want to work.", scores: [2, 2, 2, 2, 1.5, 2] },
                { text: "We'll need to redefine value: human creativity, care, and connection will matter more as routine work is automated.", scores: [2.5, 2.5, 3, 3, 2.5, 3] },
                { text: "The question assumes work should be the basis of people's worth and survival. We should decouple income from employment.", scores: [4, 3.5, 4, 4, 3.5, 3.5] },
                { text: "Under capitalism, workers only have value if they're profitable. Automation reveals this clearly. We need a system where human flourishing isn't dependent on selling your labour.", scores: [5, 4, 5, 5, 4.5, 4.5] }
            ]
        },
        {
            id: 39,
            category: "AI & Automation",
            text: "AI enables unprecedented surveillance (by governments and corporations). What's your view?",
            options: [
                { text: "Some surveillance is necessary for security. If you're not doing anything wrong, you have nothing to hide.", scores: [2, 2, 1.5, 2, 1.5, 2] },
                { text: "We need careful balance: some surveillance for legitimate purposes, but with strong privacy protections and oversight.", scores: [2.5, 2.5, 2.5, 2.5, 2.5, 2.5] },
                { text: "Current surveillance is excessive and threatens democracy. We need much stronger data rights and limits on what companies and governments can collect.", scores: [3.5, 3.5, 4, 3.5, 3.5, 3.5] },
                { text: "Surveillance serves control: of workers, of dissidents, of everyone. We should fight to dismantle surveillance systems, not just regulate them.", scores: [5, 5, 5, 5, 5, 4.5] }
            ]
        },
        {
            id: 40,
            category: "AI & Automation",
            text: "AI is being used to make decisions about hiring, loans, and criminal justice. Your view?",
            options: [
                { text: "If AI is more accurate and efficient than humans, we should use it. It might actually reduce human bias.", scores: [1.5, 2, 2, 2, 1.5, 2] },
                { text: "AI can help, but humans should always be involved in important decisions. We need transparency and accountability.", scores: [2.5, 2.5, 2.5, 2.5, 2.5, 2.5] },
                { text: "These systems often encode existing biases and remove accountability. High-stakes decisions should remain with accountable humans.", scores: [3.5, 3.5, 3.5, 4, 3.5, 3.5] },
                { text: "AI decision-making extends institutional power while making it harder to challenge. Communities should make their own decisions, not algorithms designed by corporations.", scores: [5, 5, 4.5, 5, 5, 4.5] }
            ]
        },
        {
            id: 41,
            category: "AI & Automation",
            text: "A few large tech companies control most digital infrastructure (search, social media, cloud computing). What should we do?",
            options: [
                { text: "These companies got big by being good. Breaking them up would hurt consumers. Competition will emerge naturally.", scores: [1, 1.5, 2, 1.5, 1.5, 2] },
                { text: "We need stronger antitrust enforcement and regulations to limit their power, but not necessarily break them up.", scores: [2.5, 3, 2.5, 2.5, 3, 3] },
                { text: "These are effectively utilities now and should be regulated as such, or even broken up.", scores: [3.5, 3.5, 3.5, 4, 3.5, 3] },
                { text: "Big tech should be publicly owned or transformed into platform cooperatives. Digital infrastructure is too important to be privately controlled.", scores: [5, 4, 4.5, 5, 4, 4] }
            ]
        },
        {
            id: 42,
            category: "AI & Automation",
            text: "How do you see the future of work in 20 years?",
            options: [
                { text: "New technologies always create new opportunities. Those who adapt will thrive. Markets will figure out what work is valuable.", scores: [1.5, 1.5, 2, 1.5, 1, 2] },
                { text: "We'll need significant adjustment (new education, new skills, probably some universal programs) but work will remain central to life.", scores: [2.5, 3, 2.5, 2.5, 2.5, 3] },
                { text: "We should be planning now for a society where much human labour isn't necessary. That could be liberating if we share the benefits.", scores: [4, 3.5, 4, 4, 3.5, 4] },
                { text: "Whether automation is liberation or immiseration depends entirely on who owns it. Right now we're heading toward dystopia. We need radical change.", scores: [5, 4, 5, 5, 4.5, 5] }
            ]
        },
        // SOCIAL CHANGE (Q43-Q50)
        {
            id: 43,
            category: "Social Change",
            text: "Society has changed a lot in recent decades. What's your view on the pace of social change?",
            options: [
                { text: "Change has been too fast. We've lost important traditions and values. We need to slow down and preserve what's good.", scores: [2, 2, 1, 1.5, 2, 1.5] },
                { text: "Change is inevitable, but it should be measured and respect different viewpoints. Rushing creates backlash.", scores: [2.5, 2.5, 2, 2.5, 2.5, 2.5] },
                { text: "We need more change, not less. On many issues, progress has been too slow because the powerful resist it.", scores: [3.5, 3.5, 4, 4, 4, 4] },
                { text: "Gradual change within the system is too slow for the crises we face. We need fundamental transformation, not incremental reform.", scores: [4.5, 4.5, 5, 5, 5, 5] }
            ]
        },
        {
            id: 44,
            category: "Social Change",
            text: "What's the most effective way to create positive social change?",
            options: [
                { text: "Electing good leaders and working within the system. Change happens through proper channels.", scores: [2, 2.5, 2, 2, 2.5, 2] },
                { text: "A combination: voting, advocacy, community organizing, and building coalitions across differences.", scores: [2.5, 3, 3, 3, 3, 3] },
                { text: "Organized movements pushing from outside the system are most important. Real change is won, not given.", scores: [4, 3.5, 4, 4, 4, 4] },
                { text: "Building alternatives now: creating the world you want in the shell of the old, while resisting oppression directly.", scores: [5, 5, 5, 5, 5, 5] }
            ]
        },
        {
            id: 45,
            category: "Social Change",
            text: "What role should tradition play in society?",
            options: [
                { text: "Traditions carry accumulated wisdom. We should be cautious about abandoning practices that have stood the test of time.", scores: [2, 2, 1, 1.5, 2, 1.5] },
                { text: "Some traditions are worth keeping, others should change. It depends on whether they serve us well today.", scores: [2.5, 2.5, 2.5, 2.5, 2.5, 2.5] },
                { text: "Traditions often served the powerful, not everyone. We should be willing to change practices that cause harm.", scores: [3.5, 3.5, 4, 4, 3, 3.5] },
                { text: "Many traditions encode hierarchies of domination. We should consciously create new ways of living based on equality and freedom.", scores: [5, 5, 5, 5, 4.5, 4.5] }
            ]
        },
        {
            id: 46,
            category: "Social Change",
            text: "If you believe the current system has major problems, what's the best way to fix them?",
            options: [
                { text: "The system is basically sound. It needs tweaks and updates, not radical change.", scores: [2, 2, 2, 2, 2, 2] },
                { text: "Significant reforms are needed, working through existing institutions. Radical approaches are counterproductive.", scores: [2.5, 3, 2.5, 2.5, 3, 3] },
                { text: "Structural change is necessary, but it can come through democratic struggle: movements, elections, mass pressure.", scores: [4, 3.5, 4, 4, 4, 4] },
                { text: "The system can't be reformed: it will resist fundamental change. We need to build alternatives and be prepared for rupture.", scores: [5, 5, 5, 5, 5, 5] }
            ]
        },
        {
            id: 47,
            category: "Social Change",
            text: "When facing social problems, what approach is best?",
            options: [
                { text: "Focus on individual responsibility and choice. Collective solutions often create dependency and bureaucracy.", scores: [1.5, 1.5, 2, 1, 1, 2] },
                { text: "A balance of individual and collective approaches depending on the problem.", scores: [2.5, 2.5, 2.5, 2.5, 2.5, 2.5] },
                { text: "Most serious problems require collective solutions. Individual action alone can't address systemic issues.", scores: [3.5, 3.5, 4, 4, 4, 4] },
                { text: "Collective action is essential, but it should be horizontal and participatory, not top-down government programs.", scores: [4.5, 5, 4.5, 4.5, 5, 4.5] }
            ]
        },
        {
            id: 48,
            category: "Social Change",
            text: "How do you view conflict between different groups in society?",
            options: [
                { text: "Conflict is usually harmful. We should emphasize what unites us and seek compromise and stability.", scores: [2, 2, 1.5, 2, 2, 2] },
                { text: "Some conflict is inevitable in diverse societies. Democratic processes help us work through disagreements.", scores: [2.5, 2.5, 2.5, 2.5, 3, 3] },
                { text: "Conflict between the powerful and powerless is often necessary for progress. Social movements create positive change.", scores: [3.5, 3.5, 4, 4, 4, 4] },
                { text: "The fundamental conflict is between those who own/control and those who don't. Class struggle is the engine of history.", scores: [5, 4.5, 5, 5, 5, 5] }
            ]
        },
        {
            id: 49,
            category: "Social Change",
            text: "What makes a good society?",
            options: [
                { text: "Strong families, communities, and traditions. People taking responsibility for themselves and each other locally.", scores: [2, 2, 1.5, 2, 2, 1.5] },
                { text: "Opportunity for individuals to succeed, combined with a safety net for those who struggle. Balance of freedom and support.", scores: [2.5, 2.5, 2.5, 2.5, 2.5, 2.5] },
                { text: "Equality and justice: where everyone has their needs met and can live with dignity. Strong public institutions.", scores: [3.5, 3.5, 3.5, 4, 3.5, 4] },
                { text: "A society without domination: where people relate as equals, decisions are made together, and no one has power over others.", scores: [5, 5, 5, 5, 5, 5] }
            ]
        },
        {
            id: 50,
            category: "Social Change",
            text: "Finally, how optimistic are you about the future?",
            options: [
                { text: "Human societies have always improved over time. With freedom and markets, progress continues.", scores: [1.5, 2, 2, 2, 2, 2.5] },
                { text: "Progress isn't automatic but we can make things better through good policy and working together.", scores: [2.5, 3, 3, 3, 3, 3] },
                { text: "Change requires struggle, but ordinary people have won before and can win again. There's hope in solidarity.", scores: [4, 3.5, 4, 4, 4, 4.5] },
                { text: "Another world is possible, but only if we're willing to fight for it and build it ourselves. Hope is a practice, not a feeling.", scores: [5, 5, 5, 5, 5, 5] }
            ]
        }
    ];

    // ==================== GLOSSARY ====================
    
    const glossary = {
        // Government & Politics
        "federal": "The national/central government (as opposed to provincial/local)",
        "federal government": "The national/central government of Canada",
        "provincial": "Relating to a province (like BC), not the whole country",
        "provincial government": "The government of a province (like BC)",
        "democracy": "A system where people have power, usually through voting",
        "democratic": "Decided by the people, through voting or participation",
        "electoral politics": "The system of voting for representatives",
        "representatives": "People elected to make decisions on behalf of voters",
        "proportional representation": "Electoral system where seats match vote percentages (unlike winner-take-all)",
        "sovereignty": "The right of a people or nation to govern themselves",
        "self-determination": "The right of a group to decide their own political status",
        "federation": "Independent groups voluntarily coordinating while keeping autonomy",
        "bureaucracy": "Government administration; often used critically to mean slow/impersonal",
        "technocracy": "Rule by technical experts rather than elected officials",
        "oligarchy": "Rule by a small group of wealthy/powerful people",
        "plutocracy": "Rule by the wealthy; government serving rich people's interests",
        
        // Economic Systems & Concepts
        "capitalism": "Economic system where businesses and property are privately owned for profit",
        "socialism": "Economic system where workers or the public own the means of production",
        "communism": "A classless society with common ownership and no private property",
        "social democracy": "Capitalism with strong welfare state and worker protections",
        "neoliberalism": "Economic approach favouring free markets, privatization, and reduced government",
        "market": "System where buyers and sellers exchange goods; prices set by supply/demand",
        "market-based": "Using buying/selling and prices to distribute goods (vs. government planning)",
        "supply and demand": "Economic theory: prices rise when demand exceeds supply, fall when supply exceeds demand",
        "GDP": "Gross Domestic Product: total value of goods/services produced in a country",
        "productivity": "How much output workers produce per hour of work",
        "efficiency": "Getting more output from the same input; often used to justify cost-cutting",
        
        // Economic Terms
        "tariffs": "Taxes on goods imported from other countries",
        "trade deal": "An agreement between countries about buying/selling goods",
        "free trade": "Trade without tariffs or restrictions between countries",
        "subsidies": "Government money given to support businesses or industries",
        "stimulus": "Government spending meant to boost the economy",
        "recession": "When the economy shrinks and jobs are lost",
        "inflation": "When prices rise and money buys less than before",
        "inflation-adjusted": "Calculated to account for rising prices over time (shows 'real' change)",
        "minimum wage": "The lowest hourly pay employers are legally allowed to pay",
        "living wage": "A wage high enough to afford basic needs (housing, food, etc.)",
        "median wages": "The middle point of all wages (half earn more, half earn less)",
        "median": "The middle value in a list (half above, half below); less skewed than average",
        "profit": "Money a business keeps after paying all costs",
        "profit motive": "The drive to make money that shapes business decisions",
        "shareholders": "People who own part of a company through stocks",
        "stakeholders": "Everyone affected by a company: workers, community, environment, not just owners",
        "capital": "Money/assets used to make more money; also: the investor class",
        "capital gains": "Profit from selling assets (stocks, property) for more than you paid",
        "speculation": "Buying assets hoping to sell at higher price, not for actual use",
        "externalities": "Costs (like pollution) that businesses push onto society rather than paying",
        "internalize": "Making businesses pay costs they currently push onto society",
        
        // Ownership & Economic Systems
        "privatize": "To sell a public service to a private company",
        "privatization": "Selling public services to private companies",
        "nationalize": "To make something owned by the government/public",
        "public ownership": "When the government owns something on behalf of everyone",
        "common ownership": "When something is owned by everyone together, not privately",
        "worker ownership": "When the workers own the business they work for",
        "cooperative": "A business owned and run by its workers or members",
        "co-op": "Short for cooperative: a business owned by its workers/members",
        "platform cooperative": "An app/website (like Uber) owned by its workers instead of investors",
        "means of production": "Factories, tools, land: things needed to make goods",
        "commodity": "Something produced to be sold for profit rather than used directly",
        "commodified": "Turned into something bought and sold (e.g., 'commodified healthcare')",
        "decommodified": "Removed from the market; provided as a right, not something you buy",
        "commons": "Resources shared by everyone (air, water, public land, knowledge)",
        "enclosure": "Taking common resources and making them private property",
        
        // Healthcare
        "single-payer": "Healthcare system where one public agency pays all medical bills",
        "universal healthcare": "System where everyone has access to healthcare regardless of income",
        "private insurance": "Healthcare coverage you buy from a company (vs. public coverage)",
        "public healthcare": "Healthcare funded by taxes and available to everyone",
        "pharma": "Short for pharmaceutical industry: companies that make medicines",
        "pharmaceutical": "Relating to medicines and drug companies",
        
        // Housing
        "rent control": "Laws limiting how much landlords can raise rent",
        "public housing": "Housing owned by government and rented at affordable rates",
        "affordable housing": "Housing that costs less than 30% of a household's income",
        "community land trust": "Non-profit that owns land permanently to keep housing affordable",
        "housing cooperative": "Housing owned collectively by its residents",
        "gentrification": "When wealthy people move in and prices rise, pushing out longtime residents",
        "housing crisis": "Widespread inability to afford housing; affects renters and buyers",
        
        // Taxes & Redistribution
        "inheritance": "Money or property passed down when someone dies",
        "inheritance tax": "Tax on money/property received from someone who died",
        "wealth tax": "A tax on total wealth, not just income",
        "progressive tax": "Tax where rich people pay a higher percentage",
        "regressive tax": "Tax where poor people pay higher percentage of their income (like sales tax)",
        "redistribution": "Moving wealth from rich to poor through taxes/programs",
        "tax loopholes": "Legal tricks that let people avoid paying taxes",
        "tax haven": "Country/place with very low taxes where wealthy people hide money",
        "corporate tax": "Tax on business profits",
        
        // Political Concepts
        "regulation": "Rules that control how businesses operate",
        "deregulation": "Removing rules that control businesses",
        "monopoly": "When one company controls an entire market",
        "antitrust": "Laws to prevent companies from becoming too powerful",
        "austerity": "Government cutting spending, often on social programs",
        "safety net": "Programs that help people in hard times (welfare, EI, etc.)",
        "welfare state": "Government programs providing healthcare, education, housing, etc.",
        "social programs": "Government services like healthcare, education, unemployment insurance",
        "public goods": "Things everyone benefits from (roads, schools, parks, clean air)",
        "infrastructure": "Basic systems society needs: roads, power, water, internet",
        
        // Labour & Work
        "labour": "Work; also: workers as a group (as in 'labour vs. capital')",
        "unions": "Organizations where workers join together for better conditions",
        "union": "An organization of workers who bargain collectively with employers",
        "strike": "When workers stop working to pressure employers",
        "collective bargaining": "When workers negotiate as a group with employers",
        "automation": "Using machines/computers to do work instead of people",
        "gig economy": "Work through apps (Uber, DoorDash) without traditional employment",
        "independent contractor": "Worker classified as self-employed, not employee (fewer protections)",
        "wage labour": "Working for someone else in exchange for wages (vs. owning your work)",
        "exploitation": "Profiting from others' work without fair compensation",
        "precarious work": "Jobs with low pay, no benefits, unstable hours, easy to lose",
        "job guarantee": "Government policy promising a job to anyone who wants one",
        "unemployment insurance": "Payments to workers who lose their jobs (called EI in Canada)",
        
        // Social/Political Movements
        "solidarity": "Standing together with others who face similar struggles",
        "collective action": "People working together to achieve shared goals",
        "social movements": "Organized groups pushing for social/political change",
        "direct action": "Taking action yourself rather than asking authorities",
        "mutual aid": "People helping each other directly, without government",
        "grassroots": "Organized from the bottom up by ordinary people, not leaders",
        "activism": "Taking action to create political or social change",
        "civil disobedience": "Deliberately breaking laws to protest injustice",
        
        // Class & Power
        "class": "Social group based on economic position (working class, middle class, etc.)",
        "working class": "People who work for wages and don't own businesses",
        "middle class": "People with moderate income and some financial security",
        "ruling class": "Small group who control most wealth and power",
        "class struggle": "Conflict between workers and owners over wealth and power",
        "class consciousness": "Awareness of your class position and shared interests with others in it",
        "systemic": "Built into how systems work, not just individual choices",
        "structural": "Caused by how society is organized, not just personal behaviour",
        "institutional": "Embedded in organizations and their rules/practices",
        
        // Ideology Terms
        "hierarchy": "A system where some people have power over others",
        "horizontal": "Without bosses or hierarchy; everyone is equal",
        "decentralized": "Power spread out among many local groups, not concentrated",
        "prefigurative": "Building the future you want in the present",
        "reformism": "Belief that the system can be fixed through gradual changes",
        "revolutionary": "Belief that fundamental system change is needed",
        "radical": "Going to the root of problems; wanting fundamental change",
        "reactionary": "Wanting to return to earlier social arrangements",
        "progressive": "Supporting social reform and change toward equality",
        "conservative": "Preferring traditional institutions and gradual change",
        
        // International & Historical
        "imperialism": "Powerful countries dominating weaker ones economically/militarily",
        "colonialism": "Taking control of other lands and peoples, often through settlement",
        "decolonization": "Process of undoing colonial relationships and their effects",
        "global south": "Countries historically exploited by colonialism (Africa, Asia, Latin America)",
        "global north": "Wealthy industrialized countries (North America, Europe, etc.)",
        "globalization": "Increasing connection of world economies and cultures",
        "sanctions": "Economic penalties (like trade bans) used to pressure governments",
        "intervention": "When one country interferes in another's affairs, often militarily",
        "demilitarization": "Reducing or eliminating military forces and weapons",
        "disarmament": "Getting rid of weapons, especially nuclear/military",
        
        // Environment
        "fossil fuels": "Coal, oil, and gas: energy sources that cause climate change",
        "clean energy": "Energy from renewable sources (solar, wind) that don't pollute",
        "renewable energy": "Energy from sources that won't run out (sun, wind, water)",
        "climate change": "Long-term shifts in temperatures and weather patterns, mainly from human activity",
        "climate crisis": "The urgent threat posed by climate change",
        "climate justice": "Addressing climate change while considering who is most affected",
        "carbon footprint": "The greenhouse gases produced by a person, company, or activity",
        "carbon tax": "Tax on activities that release carbon dioxide",
        "carbon pricing": "Making polluters pay for carbon emissions (through taxes or cap-and-trade)",
        "cap-and-trade": "System where government limits total emissions and companies trade pollution permits",
        "net zero": "Balancing carbon emissions with carbon removal",
        "degrowth": "Idea that we should shrink the economy to save the environment",
        "sustainability": "Meeting today's needs without harming future generations",
        "ecosystem": "A community of living things and their environment",
        "biodiversity": "Variety of life in an area; often harmed by human activity",
        
        // Technology
        "AI": "Artificial Intelligence: computer systems that can learn and make decisions",
        "artificial intelligence": "Computer systems that can learn, reason, and make decisions",
        "surveillance": "Watching and tracking people's activities",
        "digital infrastructure": "The basic tech systems everyone uses (internet, servers, etc.)",
        "algorithm": "Set of rules a computer follows; often makes decisions affecting people",
        "data": "Information collected about people, often used for profit or control",
        "UBI": "Universal Basic Income: money given to everyone regularly",
        "universal basic income": "Regular money given to everyone, no conditions",
        "job displacement": "When technology or economic changes eliminate jobs",
        "technological unemployment": "Job losses caused by machines replacing workers",
        
        // Miscellaneous
        "meritocracy": "Idea that success comes from talent and hard work (often critiqued)",
        "bootstraps": "Idea you should succeed on your own without help ('pull yourself up by your bootstraps')",
        "trickle-down": "Idea that helping the rich will eventually help everyone (widely disputed)",
        "status quo": "The current state of things; how things are now",
        "civil society": "Organizations and associations outside government and business",
        "public interest": "What benefits society as a whole, not just private individuals",
        "social contract": "Implicit agreement between people and government about rights/duties"
    };

    // ==================== CONFIGURATION ====================
    
    // TEACHER: Replace this URL with your Google Form response URL
    // Instructions: 
    // 1. Create a Google Form with these exact field titles:
    //    - "Student Name" (short answer)
    //    - "Primary Ideology" (short answer)
    //    - "Ideology Family" (short answer)
    //    - "Axis Scores" (short answer)
    //    - "Preamble Prediction" (paragraph)
    //    - "Secondary Ideology" (short answer)
    //    - "Timestamp" (short answer)
    // 2. Click the three dots menu > Get pre-filled link
    // 3. Fill in dummy data for each field, click "Get link"
    // 4. Copy the URL and replace the FORM_URL below
    // 5. The URL will look like: https://docs.google.com/forms/d/e/XXXXX/formResponse
    
    const GOOGLE_FORM_CONFIG = {
        enabled: true,
        formUrl: 'https://docs.google.com/forms/d/e/1FAIpQLSdh0vzaUOkxpRzXj_UJDCKVLQnogEIveE0GGYyQxuYeLofQgA/formResponse',
        fields: {
            studentName: 'entry.191194301',
            studentEmail: 'entry.207450381',
            primaryIdeology: 'entry.20577054',
            ideologyFamily: 'entry.1127012265',
            axisScores: 'entry.54193143',
            preamblePrediction: 'entry.723827549',
            secondaryIdeology: 'entry.1316945950',
            reflection1: 'entry.1051081359',
            reflection2: 'entry.1179017087',
            reflection3: 'entry.1024224352',
            reflection4: 'entry.590270009',
            reflection5: 'entry.2120110584',
            timestamp: 'entry.2067430166'
        }
    };

    // ==================== STATE ====================
    
    let currentQuestion = 0;
    let answers = new Array(50).fill(null);
    let shuffledOptions = [];
    let studentName = '';
    let studentEmail = '';
    let preambleResponses = {};
    let resultsData = null; // Store results for submission
    
    const STORAGE_KEY = 'ideology-assessment-progress';

    // ==================== PROGRESS SAVE/LOAD ====================
    
    function saveProgress() {
        const progress = {
            studentName,
            studentEmail,
            preambleResponses,
            currentQuestion,
            answers,
            shuffledOptions,
            savedAt: new Date().toISOString()
        };
        try {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(progress));
        } catch (e) {
            console.log('Could not save progress:', e);
        }
    }
    
    function loadProgress() {
        try {
            const saved = localStorage.getItem(STORAGE_KEY);
            if (saved) {
                return JSON.parse(saved);
            }
        } catch (e) {
            console.log('Could not load progress:', e);
        }
        return null;
    }
    
    function clearProgress() {
        try {
            localStorage.removeItem(STORAGE_KEY);
        } catch (e) {
            console.log('Could not clear progress:', e);
        }
    }
    
    function checkForSavedProgress() {
        // First check if they have completed results saved
        const savedResults = loadResultsFromStorage();
        if (savedResults && savedResults.primaryKey) {
            // They have results - offer to restore results screen
            const savedDate = savedResults.savedAt ? new Date(savedResults.savedAt).toLocaleString() : 'Unknown';
            
            document.getElementById('resume-name').textContent = studentName || savedResults.studentName || 'Student';
            document.getElementById('resume-progress').textContent = `Completed! Result: ${savedResults.primaryIdeology}`;
            document.getElementById('resume-date').textContent = `Saved: ${savedDate}`;
            document.getElementById('resume-modal').classList.add('active');
            
            // Update resume button to restore results
            document.getElementById('resume-btn').onclick = function() {
                document.getElementById('resume-modal').classList.remove('active');
                restoreResultsScreen();
            };
            return;
        }
        
        // Otherwise check for in-progress quiz
        const saved = loadProgress();
        if (saved && saved.studentName && saved.answers.some(a => a !== null)) {
            const answeredCount = saved.answers.filter(a => a !== null).length;
            const savedDate = new Date(saved.savedAt).toLocaleString();
            
            document.getElementById('resume-name').textContent = saved.studentName;
            document.getElementById('resume-progress').textContent = `${answeredCount}/50 questions answered`;
            document.getElementById('resume-date').textContent = `Last saved: ${savedDate}`;
            document.getElementById('resume-modal').classList.add('active');
            
            // Reset resume button to default behavior
            document.getElementById('resume-btn').onclick = resumeProgress;
        }
    }
    
    function resumeProgress() {
        const saved = loadProgress();
        if (saved) {
            studentName = saved.studentName;
            studentEmail = saved.studentEmail || '';
            preambleResponses = saved.preambleResponses || {};
            currentQuestion = saved.currentQuestion || 0;
            answers = saved.answers || new Array(50).fill(null);
            shuffledOptions = saved.shuffledOptions || [];
            
            // Restore name and email fields
            document.getElementById('student-name').value = studentName;
            document.getElementById('student-email').value = studentEmail;
            
            // If they have shuffled options, go straight to questions
            if (shuffledOptions.length > 0) {
                document.getElementById('resume-modal').classList.remove('active');
                showScreen('question-screen');
                renderQuestion();
            } else {
                // They only filled in preamble, restore that
                document.getElementById('preamble-ideology').value = preambleResponses.ideology || '';
                document.getElementById('axis-economic').value = preambleResponses.economic || '';
                document.getElementById('axis-state').value = preambleResponses.state || '';
                document.getElementById('axis-change').value = preambleResponses.change || '';
                document.getElementById('axis-agency').value = preambleResponses.agency || '';
                
                document.getElementById('resume-modal').classList.remove('active');
                showScreen('preamble-screen');
            }
        }
    }
    
    function startFresh() {
        clearProgress();
        // Also clear saved results and reflections
        try {
            localStorage.removeItem(RESULTS_STORAGE_KEY);
            localStorage.removeItem(REFLECTIONS_STORAGE_KEY);
        } catch (e) {}
        
        document.getElementById('resume-modal').classList.remove('active');
        // Reset state
        currentQuestion = 0;
        answers = new Array(50).fill(null);
        shuffledOptions = [];
        studentName = '';
        studentEmail = '';
        preambleResponses = {};
        resultsData = null;
        document.getElementById('student-name').value = '';
        document.getElementById('student-email').value = '';
        
        // Reset resume button to default behavior
        document.getElementById('resume-btn').onclick = resumeProgress;
    }
    
    // ==================== PORTABLE SAVE CODE ====================
    
    function generateSaveCode() {
        const progress = {
            studentName,
            studentEmail,
            preambleResponses,
            currentQuestion,
            answers,
            shuffledOptions,
            savedAt: new Date().toISOString(),
            version: 1 // For future compatibility
        };
        // Convert to JSON, then base64
        const json = JSON.stringify(progress);
        return btoa(encodeURIComponent(json));
    }
    
    function parseSaveCode(code) {
        try {
            const json = decodeURIComponent(atob(code.trim()));
            const progress = JSON.parse(json);
            // Validate required fields
            if (!progress.studentName || !progress.answers || !Array.isArray(progress.answers)) {
                throw new Error('Invalid save data');
            }
            return progress;
        } catch (e) {
            console.log('Failed to parse save code:', e);
            return null;
        }
    }
    
    function showSaveCodeModal() {
        const code = generateSaveCode();
        const answeredCount = answers.filter(a => a !== null).length;
        document.getElementById('save-code-text').value = code;
        document.getElementById('copy-confirm').style.display = 'none';
        
        // Show/hide email button based on whether we have an email
        const emailBtn = document.getElementById('email-code-btn');
        if (studentEmail) {
            emailBtn.style.display = 'inline-flex';
            emailBtn.textContent = `ðŸ“§ Email to ${studentEmail}`;
        } else {
            emailBtn.style.display = 'none';
        }
        
        document.getElementById('save-code-modal').classList.add('active');
    }
    
    function closeSaveCodeModal() {
        document.getElementById('save-code-modal').classList.remove('active');
    }
    
    function copySaveCode() {
        const textarea = document.getElementById('save-code-text');
        textarea.select();
        
        try {
            navigator.clipboard.writeText(textarea.value).then(() => {
                document.getElementById('copy-confirm').style.display = 'block';
            });
        } catch (e) {
            // Fallback for older browsers
            document.execCommand('copy');
            document.getElementById('copy-confirm').style.display = 'block';
        }
    }
    
    function emailSaveCode() {
        if (!studentEmail) {
            alert('No email address saved. Please add your email on the welcome screen.');
            return;
        }
        
        const code = document.getElementById('save-code-text').value;
        const answeredCount = answers.filter(a => a !== null).length;
        
        const subject = encodeURIComponent('Your Political Ideology Assessment Save Code');
        const body = encodeURIComponent(
`Hi ${studentName},

Here's your save code for the Political Ideology Assessment. You've completed ${answeredCount}/50 questions.

TO CONTINUE ON ANOTHER DEVICE:
1. Open the assessment
2. Click "Have a save code from another device?"
3. Paste this entire code:

${code}

(Make sure you copy the entire code above, it's long!)

Good luck finishing the assessment!`
        );
        
        // Open mailto link
        window.open(`mailto:${studentEmail}?subject=${subject}&body=${body}`, '_blank');
        
        document.getElementById('copy-confirm').textContent = 'âœ“ Email opened! Check your email app.';
        document.getElementById('copy-confirm').style.display = 'block';
    }
    
    function showLoadCodeModal() {
        document.getElementById('load-code-text').value = '';
        document.getElementById('load-error').style.display = 'none';
        document.getElementById('load-code-modal').classList.add('active');
    }
    
    function closeLoadCodeModal() {
        document.getElementById('load-code-modal').classList.remove('active');
    }
    
    function loadFromCode() {
        const code = document.getElementById('load-code-text').value;
        const errorEl = document.getElementById('load-error');
        
        if (!code.trim()) {
            errorEl.textContent = 'Please paste a save code.';
            errorEl.style.display = 'block';
            return;
        }
        
        const progress = parseSaveCode(code);
        
        if (!progress) {
            errorEl.textContent = 'Invalid save code. Make sure you copied the entire code.';
            errorEl.style.display = 'block';
            return;
        }
        
        // Restore progress
        studentName = progress.studentName;
        studentEmail = progress.studentEmail || '';
        preambleResponses = progress.preambleResponses || {};
        currentQuestion = progress.currentQuestion || 0;
        answers = progress.answers || new Array(50).fill(null);
        shuffledOptions = progress.shuffledOptions || [];
        
        // Save to localStorage too
        saveProgress();
        
        // Update UI
        document.getElementById('student-name').value = studentName;
        document.getElementById('student-email').value = studentEmail;
        closeLoadCodeModal();
        
        // Navigate to appropriate screen
        if (shuffledOptions.length > 0 && answers.some(a => a !== null)) {
            showScreen('question-screen');
            renderQuestion();
        } else if (preambleResponses.ideology) {
            document.getElementById('preamble-ideology').value = preambleResponses.ideology || '';
            document.getElementById('axis-economic').value = preambleResponses.economic || '';
            document.getElementById('axis-state').value = preambleResponses.state || '';
            document.getElementById('axis-change').value = preambleResponses.change || '';
            document.getElementById('axis-agency').value = preambleResponses.agency || '';
            showScreen('preamble-screen');
        } else {
            showScreen('preamble-screen');
        }
        
        const answeredCount = answers.filter(a => a !== null).length;
        alert(`Welcome back, ${studentName}! Your progress has been loaded (${answeredCount}/50 questions answered).`);
    }

    // ==================== NAVIGATION ====================
    
    function showScreen(screenId) {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.getElementById(screenId).classList.add('active');
        window.scrollTo(0, 0);
    }

    function startPreamble() {
        studentName = document.getElementById('student-name').value.trim();
        studentEmail = document.getElementById('student-email').value.trim();
        if (!studentName) {
            alert('Please enter your name to continue.');
            return;
        }
        saveProgress();
        showScreen('preamble-screen');
    }

    function backToWelcome() {
        showScreen('welcome-screen');
    }

    function startQuestions() {
        // Save preamble responses
        preambleResponses = {
            ideology: document.getElementById('preamble-ideology').value,
            economic: document.getElementById('axis-economic').value,
            state: document.getElementById('axis-state').value,
            change: document.getElementById('axis-change').value,
            agency: document.getElementById('axis-agency').value
        };

        // Initialize shuffled options for each question (only if not resuming)
        if (shuffledOptions.length === 0) {
            shuffledOptions = questions.map(q => {
                const indices = [0, 1, 2, 3];
                // Fisher-Yates shuffle
                for (let i = indices.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [indices[i], indices[j]] = [indices[j], indices[i]];
                }
                return indices;
            });
        }

        currentQuestion = 0;
        saveProgress();
        showScreen('question-screen');
        renderQuestion();
    }
    
    // ==================== SUBMISSION TO TEACHER ====================
    
    function getReflections() {
        return {
            reflection1: document.getElementById('reflection-1')?.value || '',
            reflection2: document.getElementById('reflection-2')?.value || '',
            reflection3: document.getElementById('reflection-3')?.value || '',
            reflection4: document.getElementById('reflection-4')?.value || '',
            reflection5: document.getElementById('reflection-5')?.value || ''
        };
    }
    
    function validateReflections() {
        const reflections = getReflections();
        const minLength = 50; // Minimum characters per reflection
        const incomplete = [];
        
        if (reflections.reflection1.length < minLength) incomplete.push('Question 1');
        if (reflections.reflection2.length < minLength) incomplete.push('Question 2');
        if (reflections.reflection3.length < minLength) incomplete.push('Question 3');
        if (reflections.reflection4.length < minLength) incomplete.push('Question 4');
        if (reflections.reflection5.length < minLength) incomplete.push('Question 5');
        
        return incomplete;
    }
    
    function submitToTeacher() {
        if (!resultsData) {
            alert('No results to submit. Please complete the assessment first.');
            return;
        }
        
        // Validate reflections
        const incomplete = validateReflections();
        if (incomplete.length > 0) {
            const proceed = confirm(`The following reflections seem short or empty:\n\n${incomplete.join(', ')}\n\nAre you sure you want to submit? Your teacher expects thoughtful responses.`);
            if (!proceed) return;
        }
        
        const reflections = getReflections();
        const statusEl = document.getElementById('submit-status');
        
        if (!GOOGLE_FORM_CONFIG.enabled) {
            // Fallback: copy to clipboard for manual submission
            const submissionText = formatSubmissionText();
            
            if (navigator.clipboard) {
                navigator.clipboard.writeText(submissionText).then(() => {
                    statusEl.textContent = 'âœ“ Results copied to clipboard! Paste into email or submission form.';
                    statusEl.className = 'submit-status success';
                    document.getElementById('submit-btn').textContent = 'âœ“ Copied to Clipboard';
                    document.getElementById('submit-btn').disabled = true;
                }).catch(() => {
                    showManualCopyDialog(submissionText);
                });
            } else {
                showManualCopyDialog(submissionText);
            }
            return;
        }
        
        // Submit to Google Form
        const formData = new URLSearchParams();
        formData.append(GOOGLE_FORM_CONFIG.fields.studentName, studentName);
        if (GOOGLE_FORM_CONFIG.fields.studentEmail) {
            formData.append(GOOGLE_FORM_CONFIG.fields.studentEmail, studentEmail || '');
        }
        formData.append(GOOGLE_FORM_CONFIG.fields.primaryIdeology, resultsData.primaryIdeology);
        formData.append(GOOGLE_FORM_CONFIG.fields.ideologyFamily, resultsData.family);
        formData.append(GOOGLE_FORM_CONFIG.fields.axisScores, resultsData.axisScores.map((s, i) => {
            const names = ['Economic', 'State', 'Change', 'Inequality', 'Agency', 'International'];
            return `${names[i]}: ${s.toFixed(2)}`;
        }).join('; '));
        formData.append(GOOGLE_FORM_CONFIG.fields.preamblePrediction, preambleResponses.ideology || 'Not provided');
        formData.append(GOOGLE_FORM_CONFIG.fields.secondaryIdeology, `${resultsData.secondaryIdeology} (${resultsData.secondaryFamily}): ${resultsData.secondarySummary}`);
        
        // Add reflections
        formData.append(GOOGLE_FORM_CONFIG.fields.reflection1, reflections.reflection1);
        formData.append(GOOGLE_FORM_CONFIG.fields.reflection2, reflections.reflection2);
        formData.append(GOOGLE_FORM_CONFIG.fields.reflection3, reflections.reflection3);
        formData.append(GOOGLE_FORM_CONFIG.fields.reflection4, reflections.reflection4);
        formData.append(GOOGLE_FORM_CONFIG.fields.reflection5, reflections.reflection5);
        
        formData.append(GOOGLE_FORM_CONFIG.fields.timestamp, new Date().toISOString());
        
        // Debug: log what we're submitting
        console.log('=== FORM SUBMISSION DEBUG ===');
        console.log('Submitting to:', GOOGLE_FORM_CONFIG.formUrl);
        for (const [key, value] of formData.entries()) {
            console.log(`${key}: ${value.substring(0, 100)}${value.length > 100 ? '...' : ''}`);
        }
        
        // Try multiple submission methods for reliability
        
        // Method 1: sendBeacon (most reliable for fire-and-forget)
        if (navigator.sendBeacon) {
            const blob = new Blob([formData.toString()], { type: 'application/x-www-form-urlencoded' });
            const sent = navigator.sendBeacon(GOOGLE_FORM_CONFIG.formUrl, blob);
            console.log('sendBeacon result:', sent);
        }
        
        // Method 2: fetch with no-cors
        fetch(GOOGLE_FORM_CONFIG.formUrl, {
            method: 'POST',
            mode: 'no-cors',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded'
            },
            body: formData.toString()
        }).then(() => {
            console.log('Form submitted via fetch');
        }).catch(err => {
            console.error('Fetch error:', err);
        });
        
        // Update UI
        document.getElementById('submit-btn').innerHTML = 'âœ“ Submitted Successfully!';
        document.getElementById('submit-btn').disabled = true;
        document.getElementById('submit-btn').classList.add('submitted');
        statusEl.textContent = 'Your results and reflections have been sent to your teacher.';
        statusEl.className = 'submit-status success';
        
        // Clear saved progress since they're done
        clearProgress();
    }
    
    function formatSubmissionText() {
        const reflections = getReflections();
        const lines = [
            `IDEOLOGY ASSESSMENT SUBMISSION`,
            `Student: ${studentName}`,
            `Email: ${studentEmail || 'Not provided'}`,
            `Date: ${new Date().toLocaleString()}`,
            ``,
            `â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•`,
            ``,
            `PRIMARY RESULT: ${resultsData.primaryIdeology}`,
            `Family: ${resultsData.family}`,
            `Secondary: ${resultsData.secondaryIdeology}`,
            ``,
            `AXIS SCORES:`,
            ...resultsData.axisScores.map((s, i) => {
                const names = ['Economic', 'State', 'Change', 'Inequality', 'Agency', 'International'];
                return `  ${names[i]}: ${s.toFixed(2)}/5`;
            }),
            ``,
            `PREAMBLE PREDICTION: ${preambleResponses.ideology || 'Not provided'}`,
            ``,
            `â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•`,
            ``,
            `REFLECTIONS:`,
            ``,
            `1. Compare prediction to result:`,
            reflections.reflection1 || '[No response]',
            ``,
            `2. Examine axis scores:`,
            reflections.reflection2 || '[No response]',
            ``,
            `3. Questions that made you think:`,
            reflections.reflection3 || '[No response]',
            ``,
            `4. Connecting to debates:`,
            reflections.reflection4 || '[No response]',
            ``,
            `5. Limitations and growth:`,
            reflections.reflection5 || '[No response]'
        ];
        return lines.join('\n');
    }
    
    function showManualCopyDialog(text) {
        const textarea = document.createElement('textarea');
        textarea.value = text;
        textarea.style.position = 'fixed';
        textarea.style.top = '50%';
        textarea.style.left = '50%';
        textarea.style.transform = 'translate(-50%, -50%)';
        textarea.style.width = '80%';
        textarea.style.maxWidth = '500px';
        textarea.style.height = '300px';
        textarea.style.zIndex = '10000';
        textarea.style.padding = '1rem';
        textarea.style.fontFamily = 'monospace';
        textarea.style.fontSize = '12px';
        textarea.style.background = '#1a1a1a';
        textarea.style.color = '#e8e8e8';
        textarea.style.border = '2px solid #c9f66f';
        textarea.style.borderRadius = '8px';
        document.body.appendChild(textarea);
        textarea.select();
        alert('Copy this text and send it to your teacher. Press OK then Ctrl+C (or Cmd+C) to copy.');
        
        textarea.addEventListener('blur', () => {
            document.body.removeChild(textarea);
        });
    }
    
    // Initialize on page load
    document.addEventListener('DOMContentLoaded', checkForSavedProgress);
    
    // ==================== GLOSSARY PROCESSING ====================
    
    function applyGlossary(text) {
        // Sort terms by length (longest first) to avoid partial matches
        const sortedTerms = Object.keys(glossary).sort((a, b) => b.length - a.length);
        
        const usedTerms = new Set();
        const replacements = []; // Store replacements to apply later
        
        // First pass: find all matches and store as placeholders
        for (const term of sortedTerms) {
            const termLower = term.toLowerCase();
            if (usedTerms.has(termLower)) continue;
            
            const regex = new RegExp(`\\b(${term.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')})\\b`, 'i');
            const match = text.match(regex);
            
            if (match) {
                const placeholder = `\x00GLOSS${replacements.length}\x00`;
                const html = `<span class="glossary-term" data-term="${termLower}">${match[0]}<span class="glossary-tooltip">${glossary[term]}</span></span>`;
                
                replacements.push(html);
                text = text.replace(regex, placeholder);
                usedTerms.add(termLower);
            }
        }
        
        // Second pass: replace placeholders with actual HTML
        for (let i = 0; i < replacements.length; i++) {
            text = text.replace(`\x00GLOSS${i}\x00`, replacements[i]);
        }
        
        return text;
    }
    
    // Handle glossary term clicks (for mobile)
    document.addEventListener('click', function(e) {
        // Close all open tooltips first
        document.querySelectorAll('.glossary-term.active').forEach(el => {
            if (el !== e.target && !el.contains(e.target)) {
                el.classList.remove('active');
            }
        });
        
        // Toggle clicked term
        const term = e.target.closest('.glossary-term');
        if (term) {
            e.stopPropagation();
            term.classList.toggle('active');
        }
    });

    // ==================== LEARN MORE LINKS ====================
    
    // Wikipedia article titles don't always match ideology names
    const wikiOverrides = {
        "Traditional Conservative": "Traditionalist_conservatism",
        "Paternalistic Conservative (Red Tory)": "Red_Tory",
        "Fiscal Conservative": "Fiscal_conservatism",
        "National Conservative": "National_conservatism",
        "Right-Libertarian": "Right-libertarianism",
        "Classical Liberal": "Classical_liberalism",
        "Social Liberal": "Social_liberalism",
        "Progressive Liberal": "Progressivism",
        "Neoliberal": "Neoliberalism",
        "Nordic Social Democrat": "Nordic_model",
        "Third Way Social Democrat": "Third_Way",
        "Left Social Democrat": "Social_democracy",
        "Democratic Socialist": "Democratic_socialism",
        "Marxist": "Marxism",
        "Market Socialist": "Market_socialism",
        "Eco-Socialist": "Eco-socialism",
        "Anarcho-Communist": "Anarcho-communism",
        "Anarcho-Syndicalist": "Anarcho-syndicalism",
        "Mutualist": "Mutualism_(economic_theory)",
        "Social Anarchist": "Social_anarchism",
        "Green Anarchist": "Green_anarchism",
        "Communitarian": "Communitarianism",
        "Left-Libertarian": "Left-libertarianism",
        "Techno-Progressive": "Techno-progressivism",
        // Families
        "Conservative": "Conservatism",
        "Liberal": "Liberalism",
        "Social Democratic": "Social_democracy",
        "Socialist": "Socialism",
        "Anarchist": "Anarchism",
        "Conservative/Libertarian": "Libertarianism"
    };
    
    function generateLearnMoreLinks(ideology) {
        const wikiBase = 'https://en.wikipedia.org/wiki/';
        const links = [];
        
        // Link to the ideology itself (use override if exists)
        const ideologyWikiName = wikiOverrides[ideology.name] || ideology.name.replace(/ /g, '_');
        links.push(`<li><strong>Your ideology:</strong> <a href="${wikiBase}${ideologyWikiName}" target="_blank" rel="noopener">${ideology.name} on Wikipedia</a></li>`);
        
        // Link to the broader family (use override if exists)
        const familyWikiName = wikiOverrides[ideology.family] || ideology.family.replace(/ /g, '_');
        if (ideology.family !== ideology.name) {
            links.push(`<li><strong>Broader tradition:</strong> <a href="${wikiBase}${familyWikiName}" target="_blank" rel="noopener">${ideology.family} on Wikipedia</a></li>`);
        }
        
        // Links to key thinkers
        if (ideology.thinkers) {
            const thinkers = ideology.thinkers.split(', ').slice(0, 3); // Max 3 thinkers
            const thinkerLinks = thinkers.map(thinker => {
                const thinkerWikiName = thinker.trim().replace(/ /g, '_');
                return `<a href="${wikiBase}${encodeURIComponent(thinkerWikiName)}" target="_blank" rel="noopener">${thinker.trim()}</a>`;
            }).join(', ');
            links.push(`<li><strong>Key thinkers:</strong> ${thinkerLinks}</li>`);
        }
        
        // Google search for contemporary discussion
        const searchQuery = encodeURIComponent(`${ideology.name} political philosophy`);
        links.push(`<li><strong>Current discussions:</strong> <a href="https://www.google.com/search?q=${searchQuery}" target="_blank" rel="noopener">Search for "${ideology.name}"</a></li>`);
        
        return `<ul>${links.join('')}</ul><p style="margin-top: 1rem; font-size: 0.9rem; color: var(--text-secondary);"><em>Note: Wikipedia is a starting point, not a final authority. Consider the sources cited in any article you read.</em></p>`;
    }

    // ==================== QUESTIONS ====================
    
    function renderQuestion() {
        const q = questions[currentQuestion];
        const shuffled = shuffledOptions[currentQuestion];
        
        document.getElementById('question-category').textContent = q.category;
        document.getElementById('question-text').innerHTML = applyGlossary(q.text);
        
        // Update progress
        const progress = ((currentQuestion + 1) / questions.length) * 100;
        document.getElementById('progress-fill').style.width = progress + '%';
        document.getElementById('progress-text').textContent = `Question ${currentQuestion + 1} of ${questions.length}`;
        
        // Render options in shuffled order
        const optionsHtml = shuffled.map((optionIndex, displayIndex) => {
            const option = q.options[optionIndex];
            const letter = ['A', 'B', 'C', 'D'][displayIndex];
            const selected = answers[currentQuestion] === optionIndex ? 'selected' : '';
            return `
                <div class="option ${selected}" onclick="selectOption(${optionIndex})">
                    <span class="option-letter">${letter})</span>
                    ${applyGlossary(option.text)}
                </div>
            `;
        }).join('');
        
        document.getElementById('options-container').innerHTML = optionsHtml;
        
        // Update navigation buttons
        document.getElementById('prev-btn').style.visibility = currentQuestion === 0 ? 'hidden' : 'visible';
        document.getElementById('next-btn').textContent = currentQuestion === questions.length - 1 ? 'See Results' : 'Next';
    }

    function selectOption(optionIndex) {
        answers[currentQuestion] = optionIndex;
        saveProgress();
        renderQuestion(); // Re-render to show selection
    }

    function nextQuestion() {
        if (answers[currentQuestion] === null) {
            alert('Please select an answer before continuing.');
            return;
        }
        
        if (currentQuestion < questions.length - 1) {
            currentQuestion++;
            renderQuestion();
        } else {
            calculateResults();
        }
    }

    function prevQuestion() {
        if (currentQuestion > 0) {
            currentQuestion--;
            renderQuestion();
        }
    }

    // ==================== RESULTS ====================
    
    function calculateResults() {
        // Calculate average scores on each axis
        // Axes: [Economic, State, Change, Inequality, Agency, International]
        const axisTotals = [0, 0, 0, 0, 0, 0];
        
        answers.forEach((answerIndex, questionIndex) => {
            const scores = questions[questionIndex].options[answerIndex].scores;
            scores.forEach((score, axisIndex) => {
                axisTotals[axisIndex] += score;
            });
        });
        
        const axisAverages = axisTotals.map(total => total / questions.length);
        
        // Find closest ideology match
        let closestIdeology = null;
        let closestDistance = Infinity;
        let secondClosest = null;
        let secondDistance = Infinity;
        
        for (const [key, ideology] of Object.entries(ideologies)) {
            const distance = euclideanDistance(axisAverages, ideology.profile);
            if (distance < closestDistance) {
                secondClosest = closestIdeology;
                secondDistance = closestDistance;
                closestIdeology = key;
                closestDistance = distance;
            } else if (distance < secondDistance) {
                secondClosest = key;
                secondDistance = distance;
            }
        }
        
        displayResults(closestIdeology, secondClosest, axisAverages, closestDistance, secondDistance);
    }

    function euclideanDistance(a, b) {
        return Math.sqrt(a.reduce((sum, val, i) => sum + Math.pow(val - b[i], 2), 0));
    }

    function displayResults(primaryKey, secondaryKey, axisScores, primaryDist, secondaryDist) {
        const primary = ideologies[primaryKey];
        const secondary = ideologies[secondaryKey];
        
        // Store results for submission
        resultsData = {
            primaryIdeology: primary.name,
            secondaryIdeology: secondary.name,
            secondarySummary: secondary.summary,
            secondaryFamily: secondary.family,
            family: primary.family,
            axisScores: axisScores,
            primaryKey: primaryKey,
            secondaryKey: secondaryKey,
            primaryDist: primaryDist,
            secondaryDist: secondaryDist
        };
        
        // Save results to localStorage so refresh doesn't lose them
        saveResultsToStorage();
        
        renderResultsScreen(primary, secondary, axisScores, primaryDist, secondaryDist);
        showScreen('results-screen');
    }
    
    function renderResultsScreen(primary, secondary, axisScores, primaryDist, secondaryDist) {
        document.getElementById('result-ideology').textContent = primary.name;
        document.getElementById('result-family').textContent = `Broader tradition: ${primary.family}`;
        document.getElementById('result-description').innerHTML = `<p>${applyGlossary(primary.summary)}</p>`;
        document.getElementById('result-thinkers').textContent = primary.thinkers;
        document.getElementById('result-examples').textContent = primary.examples;
        document.getElementById('result-connection').innerHTML = `<p>${applyGlossary(primary.connection)}</p>`;
        
        // Canadian parties section
        if (primary.canadianParties) {
            document.getElementById('canadian-parties-content').innerHTML = `<p>${applyGlossary(primary.canadianParties)}</p>`;
        }
        
        // Learn More links
        const learnMoreHtml = generateLearnMoreLinks(primary);
        document.getElementById('learn-more-links').innerHTML = learnMoreHtml;
        
        // Secondary result
        const confidence = secondaryDist - primaryDist;
        if (confidence < 0.5) {
            document.getElementById('secondary-ideology').textContent = `${secondary.name} (${secondary.family})`;
            document.getElementById('secondary-description').innerHTML = `<p style="margin-bottom: 1rem;"><em>Your responses also show significant alignment with this position. The difference between your top two matches was small, suggesting you may draw from both traditions.</em></p><p>${applyGlossary(secondary.summary)}</p>`;
        } else {
            document.getElementById('secondary-ideology').textContent = `${secondary.name} (${secondary.family})`;
            document.getElementById('secondary-description').innerHTML = `<p style="margin-bottom: 1rem;"><em>This was your second-closest match. You might find some ideas from this tradition resonate with you as well.</em></p><p>${applyGlossary(secondary.summary)}</p>`;
        }
        
        // Axis scores visualization with clear labels
        const axisNames = ['Economic', 'State Role', 'Change', 'Inequality', 'Agency', 'International'];
        const axisDescLeft = [
            'Free markets, private ownership',
            'Minimal government role', 
            'Preserve traditions, slow change',
            'Individual effort matters most',
            'Individual freedom & choice',
            'National interests first'
        ];
        const axisDescRight = [
            'Collective/worker ownership',
            'Strong state OR abolish the state',
            'Transform society fundamentally',
            'Systemic/structural change needed',
            'Collective power & solidarity',
            'International solidarity, open borders'
        ];
        
        const scoresHtml = axisScores.map((score, i) => {
            const percentage = ((score - 1) / 4) * 100; // Convert 1-5 to 0-100%
            return `
                <div class="axis-score-row">
                    <div class="axis-label">${axisNames[i]}</div>
                    <div class="axis-bar-container">
                        <div class="axis-endpoints">
                            <span class="axis-endpoint-left">1</span>
                            <span class="axis-endpoint-right">5</span>
                        </div>
                        <div class="axis-bar">
                            <div class="axis-bar-fill" style="width: ${percentage}%"></div>
                            <div class="axis-marker" style="left: ${percentage}%"></div>
                        </div>
                        <div class="axis-desc-row">
                            <span class="axis-desc-left">${axisDescLeft[i]}</span>
                            <span class="axis-desc-right">${axisDescRight[i]}</span>
                        </div>
                    </div>
                    <div class="axis-score-value">${score.toFixed(1)}</div>
                </div>
            `;
        }).join('');
        
        document.getElementById('axis-scores-display').innerHTML = scoresHtml;
        
        // Restore any saved reflections
        loadReflectionsFromStorage();
    }
    
    // ==================== RESULTS PERSISTENCE ====================
    
    const RESULTS_STORAGE_KEY = 'ideology-assessment-results';
    const REFLECTIONS_STORAGE_KEY = 'ideology-assessment-reflections';
    
    function saveResultsToStorage() {
        try {
            localStorage.setItem(RESULTS_STORAGE_KEY, JSON.stringify(resultsData));
        } catch (e) {
            console.log('Could not save results:', e);
        }
    }
    
    function loadResultsFromStorage() {
        try {
            const saved = localStorage.getItem(RESULTS_STORAGE_KEY);
            if (saved) {
                return JSON.parse(saved);
            }
        } catch (e) {
            console.log('Could not load results:', e);
        }
        return null;
    }
    
    function saveReflectionsToStorage() {
        const reflections = getReflections();
        try {
            localStorage.setItem(REFLECTIONS_STORAGE_KEY, JSON.stringify(reflections));
        } catch (e) {
            console.log('Could not save reflections:', e);
        }
    }
    
    function loadReflectionsFromStorage() {
        try {
            const saved = localStorage.getItem(REFLECTIONS_STORAGE_KEY);
            if (saved) {
                const reflections = JSON.parse(saved);
                if (reflections.reflection1) document.getElementById('reflection-1').value = reflections.reflection1;
                if (reflections.reflection2) document.getElementById('reflection-2').value = reflections.reflection2;
                if (reflections.reflection3) document.getElementById('reflection-3').value = reflections.reflection3;
                if (reflections.reflection4) document.getElementById('reflection-4').value = reflections.reflection4;
                if (reflections.reflection5) document.getElementById('reflection-5').value = reflections.reflection5;
            }
        } catch (e) {
            console.log('Could not load reflections:', e);
        }
    }
    
    function restoreResultsScreen() {
        const savedResults = loadResultsFromStorage();
        if (savedResults && savedResults.primaryKey) {
            resultsData = savedResults;
            const primary = ideologies[savedResults.primaryKey];
            const secondary = ideologies[savedResults.secondaryKey];
            if (primary && secondary) {
                renderResultsScreen(primary, secondary, savedResults.axisScores, savedResults.primaryDist, savedResults.secondaryDist);
                showScreen('results-screen');
                return true;
            }
        }
        return false;
    }
    
    // Auto-save reflections as user types
    document.addEventListener('DOMContentLoaded', function() {
        ['reflection-1', 'reflection-2', 'reflection-3', 'reflection-4', 'reflection-5'].forEach(id => {
            const el = document.getElementById(id);
            if (el) {
                el.addEventListener('input', saveReflectionsToStorage);
            }
        });
    });

    function downloadResults() {
        const primary = document.getElementById('result-ideology').textContent;
        const family = document.getElementById('result-family').textContent;
        const description = document.getElementById('result-description').textContent;
        const reflections = getReflections();
        
        let text = `POLITICAL IDEOLOGY ASSESSMENT RESULTS\n`;
        text += `Student: ${studentName}\n`;
        text += `Date: ${new Date().toLocaleDateString()}\n\n`;
        text += `â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n`;
        text += `PRIMARY RESULT: ${primary}\n`;
        text += `${family}\n\n`;
        text += `WHAT THIS MEANS:\n${description}\n\n`;
        text += `â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n`;
        text += `AXIS SCORES:\n`;
        const axisNames = ['Economic', 'State Role', 'Change', 'Inequality', 'Agency', 'International'];
        resultsData.axisScores.forEach((score, i) => {
            text += `  ${axisNames[i]}: ${score.toFixed(2)}/5\n`;
        });
        text += `\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n`;
        text += `YOUR PREAMBLE PREDICTIONS:\n\n`;
        text += `Which ideology did you predict?\n${preambleResponses.ideology || '[Not completed]'}\n\n`;
        text += `Economic axis prediction:\n${preambleResponses.economic || '[Not completed]'}\n\n`;
        text += `State role prediction:\n${preambleResponses.state || '[Not completed]'}\n\n`;
        text += `Change axis prediction:\n${preambleResponses.change || '[Not completed]'}\n\n`;
        text += `Agency axis prediction:\n${preambleResponses.agency || '[Not completed]'}\n\n`;
        text += `â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n`;
        text += `YOUR REFLECTIONS:\n\n`;
        text += `1. Compare your prediction to your result:\n${reflections.reflection1 || '[Not completed]'}\n\n`;
        text += `2. Examine your axis scores:\n${reflections.reflection2 || '[Not completed]'}\n\n`;
        text += `3. Questions that made you think:\n${reflections.reflection3 || '[Not completed]'}\n\n`;
        text += `4. Connecting to the debates:\n${reflections.reflection4 || '[Not completed]'}\n\n`;
        text += `5. Limitations and growth:\n${reflections.reflection5 || '[Not completed]'}\n`;
        
        const blob = new Blob([text], { type: 'text/plain' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `ideology-results-${studentName.replace(/\s+/g, '-')}.txt`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
    }
    </script>
</body>
</html>
